import{s as be,a as xe}from"./index-Nw62TRQM.js";import{s as _e}from"./index-CPPysieM.js";import{s as we}from"./index-KMRi1HSj.js";import{_ as ke,a as Ce,r as s,j as $e,k as Ve,w as G,o as Se,f as k,c as H,h as i,b as t,l as j,m as qe,F as W,i as Be,n as Ae,g as T,A as X,p as Le,e as je,t as V,q as Te,s as Pe,x as ze}from"./index-DjPLoeWi.js";import{l as Ue,N as De}from"./NotFound-DRH08-Sf.js";const Ee={class:"grid text-end"},Fe={class:"col-12"},Ie={class:"card"},Ne={class:"col-12",style:{"text-align":"end"}},Oe={class:"w-full mt-2 mb-6"},Re={class:"w-full mt-2 mb-4"},Je={class:"w-full mb-6"},Me={style:{display:"flex","justify-content":"center"}},Ge={style:{"justify-content":"space-between"},class:"flex mt-2 flex-column md:flex-row md:justify-content-between md:align-items-center"},He={class:"flex justify-between w-full"},Ke={class:"text-right"},Qe={class:"flex gap-3"},We={class:"col-12"},Xe={style:{"justify-content":"space-between"},class:"flex f w-full mb-6"},Ye={class:"td mt-3"},Ze={class:"font-medium text-1xl ml-2"},el={class:"td mt-3"},ll={class:"font-medium text-1xl ml-2"},tl={class:"td mt-3"},sl={class:"text-1xl ml-2"},al={class:"td mt-3"},ol={class:"font-medium text-1xl ml-2"},nl={class:"td mt-3"},ul={class:"font-medium text-1xl ml-2"},rl={class:"th mt-3"},il={class:"text-1xl font-medium"},dl={class:"loading-state"},cl={class:"empty-state"},pl={__name:"BuyAdv",setup(vl){const S=Ce();s(!1);const c=s([]),{proxy:y}=Be(),h=$e(),b=JSON.parse(localStorage.getItem("token")),K=Ve();s(!1),s(!1);const C=s(null),Y=s([{name:"المشتركين ( الفعال )",id:1},{name:"المشتركين ( المنتهي )",id:2}]);s({name:"",email:"",phone:"",password:"",confirm_password:""});const p=s([]),v=s([]),$=s(!1),q=async l=>{$.value=!0;try{let e=S.extractDateInput(S.from),n=S.extractDateInput(S.to);const m=await k.request({url:y.$localhost+"/api/admin/all-subscription",method:"get",headers:{Authorization:"Bearer "+b},params:{from:l?e:null,to:l?n:null}});m.status===200&&(p.value=m.data.data.SubscriptionCurrently.map(u=>(u.search=`${u.name} ${u.uuid}  ${u.plan_name} ${M(u.user_type)}`,u)),f.value=p.value,v.value=m.data.data.EndedSubscription.map(u=>(u.search=`${u.name} ${u.uuid} ${u.plan_name} ${M(u.user_type)}`,u)),g.value=v.value)}catch(e){console.error("Error fetching owners:",e),h.add({severity:"error",summary:"Error",detail:e.message,life:4e3})}finally{$.value=!1,S.displayReport=!1}},B=s(!1),z=s(null),Z=l=>{console.log(l),z.value=l,B.value=!B.value},ee=(l,e)=>{d.value=!0;try{k.request({url:y.$localhost+"/api/admin/create-subscription",method:"post",headers:{Authorization:"Bearer "+b},data:{uuid:z.value,account_id:e,plan_id:l}}).then(n=>{n?(h.add({severity:"success",summary:"إنشاء الاشتراك",detail:"تم إنشاء الاشتراك بنجاح  ",life:3e3}),q(),c.value=null,B.value=!1,z.value="",A.value=null,L.value=null):(h.add({severity:"error",summary:"إنشاء الاشتراك",detail:"حدث خطأ غير متوقع",life:3e3}),console.error("Unexpected response:",n))}).catch(n=>{throw h.add({severity:"error",summary:"إنشاء الاشتراك",detail:n.message,life:3e3}),console.error("Error changing subscription:",n),n}).finally(()=>{d.value=!1})}catch(n){console.error("Outer catch block:",n),d.value=!1}},d=s(!1),le=(l,e)=>{K.require({target:l.target,message:"هل انت متأكد من الغاء الاشتراك",icon:"pi pi-exclamation-triangle",rejectProps:{label:"الغاء",severity:"secondary",outlined:!0},acceptProps:{severity:"help",label:"موافق"},accept:()=>{d.value=!0,k.request({url:y.$localhost+"/api/admin/cancel-subscription/"+e,method:"get",headers:{Authorization:"Bearer "+b}}).then(n=>{n&&(h.add({severity:"success",summary:"الغاء الاشتراك",detail:"تم الغاء الاشتراك بنجاح  ",life:3e3}),q(),c.value=null),d.value=!1}),d.value=!1},reject:()=>{}})},te=(l,e)=>{K.require({target:l.target,message:"هل انت متأكد من تجديد الاشتراك",icon:"pi pi-exclamation-triangle",rejectProps:{label:"الغاء",severity:"secondary",outlined:!0},acceptProps:{severity:"help",label:"موافق"},accept:()=>{d.value=!0,k.request({url:y.$localhost+"/api/admin/renew-subscription/"+e,method:"get",headers:{Authorization:"Bearer "+b}}).then(n=>{n&&(h.add({severity:"success",summary:"تجديد الاشتراك",detail:"تم تجديد الاشتراك بنجاح  ",life:3e3}),q(),c.value=null),d.value=!1}),d.value=!1},reject:()=>{}})};s(null);const U=s([]),se=()=>{k.request({url:y.$localhost+"/api/admin/plans",method:"get",headers:{Authorization:"Bearer "+b}}).then(l=>{l&&(U.value=l.data.data)})},A=s(null),D=s([]);function ae(l){setTimeout(()=>{l.query.trim().length?D.value=U.value.filter(e=>e.name.toLowerCase().includes(l.query.toLowerCase())):D.value=[...U.value]},250)}const E=s(!1),F=s([]),oe=l=>{E.value=!0;try{k.request({url:y.$localhost+"/api/admin/accounts/"+l,method:"post",headers:{Authorization:"Bearer "+b}}).then(e=>{e&&(F.value=e.data.data)})}catch(e){console.log(e)}finally{E.value=!1}},L=s(null),I=s([]);function ne(l){setTimeout(()=>{l.query.trim().length?I.value=F.value.filter(e=>e.account_holder_name.toLowerCase().includes(l.query.toLowerCase())):I.value=[...F.value]},250)}const x=s([]),N=s([]),f=s([]),ue=()=>{x.value=[...f.value],p.value=f.value},re=l=>{setTimeout(()=>{l.query.trim().length!=null||l.query.trim().length!=""?l.inputType==="backspace"||l.query.trim().length===null?(x.value=[...f.value],p.value=f.value):(x.value=f.value.filter(e=>e.search.toLowerCase().includes(l.query.toLowerCase())),p.value=x.value):p.value=f.value},50)},_=s([]),O=s([]),g=s([]),ie=()=>{_.value=[...g.value],v.value=g.value},de=l=>{setTimeout(()=>{l.query.trim().length!=null||l.query.trim().length!=""?l.inputType==="backspace"||l.query.trim().length===null?(_.value=[...g.value],v.value=g.value):(_.value=g.value.filter(e=>e.search.toLowerCase().includes(l.query.toLowerCase())),v.value=_.value):v.value=g.value},50)};G(N.value,l=>{l.length!==0?(x.value=l.filter(e=>e.search),p.value=x.value):p.value=f.value},{deep:!0}),G(O.value,l=>{l.length!==0?(_.value=l.filter(e=>e.search),v.value=_.value):v.value=g.value},{deep:!0}),Se(()=>{q(),se(),pe()});const R=s([]),ce=s([{name:"طالب جامعي",name2:"college_student"},{name:"خريج جامعة",name2:"university_graduate"},{name:"طالب ثانوي",name2:"high_school_graduate"}]),pe=async()=>{$.value=!0;try{const l=await k.get(y.$localhost+"/api/admin/banks",{headers:{Authorization:"Bearer "+b}});l.status===200&&(R.value=l.data.data)}catch(l){console.error("Error fetching universities:",l),h.add({severity:"error",summary:"Error",detail:l.message,life:4e3})}$.value=!1},P=s(null),J=s([]);function ve(l){setTimeout(()=>{l.query.trim().length?J.value=R.value.filter(e=>e.name.toLowerCase().includes(l.query.toLowerCase())):J.value=[...R.value]},250)}function M(l){const e=ce.value.find(n=>n.name2===l);return e?e.name:"لم يحدد"}return G(P,(l,e)=>{l!=null&&l.id&&l!==e&&oe(l.id)}),(l,e)=>{const n=Te,m=xe,u=Pe,me=Ae,fe=ze,ge=we,ye=_e,he=be;return T(),H(W,null,[i(n),t("div",Ee,[t("div",Fe,[t("div",Ie,[e[29]||(e[29]=t("h5",{style:{"font-size":"large"}},"الإشتراكات",-1)),i(me,{header:" الاشتراك",visible:B.value,"onUpdate:visible":e[7]||(e[7]=a=>B.value=a),style:{width:"80vh"},modal:!0},{default:j(()=>[t("div",Ne,[t("div",Oe,[e[19]||(e[19]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," اختيار الخطة ",-1)),i(m,{class:"w-full text-end",modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=a=>A.value=a),suggestions:D.value,optionLabel:"name",placeholder:"الخطة",dropdown:"",onComplete:e[1]||(e[1]=a=>ae(a))},null,8,["modelValue","suggestions"])]),t("div",Re,[e[20]||(e[20]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," البنوك ",-1)),i(m,{class:"w-full text-end",modelValue:P.value,"onUpdate:modelValue":e[2]||(e[2]=a=>P.value=a),suggestions:J.value,optionLabel:"name",placeholder:" إختيار البنك",dropdown:"",onComplete:e[3]||(e[3]=a=>ve(a))},null,8,["modelValue","suggestions"])]),t("div",Je,[e[21]||(e[21]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," اختيار الحساب ",-1)),i(m,{class:"w-full text-end",modelValue:L.value,"onUpdate:modelValue":e[4]||(e[4]=a=>L.value=a),disabled:E.value||!P.value,suggestions:I.value,optionLabel:"account_holder_name",placeholder:"الحساب",dropdown:"",onComplete:e[5]||(e[5]=a=>ne(a))},null,8,["modelValue","disabled","suggestions"])]),t("div",Me,[i(u,{loading:d.value,disabled:L.value==null||A.value==null,onClick:e[6]||(e[6]=a=>{var o,w;return ee((o=A.value)==null?void 0:o.id,(w=L.value)==null?void 0:w.account_number)}),label:"إنشاء  الاشتراك ",class:"w-full",severity:"help"},null,8,["loading","disabled"])])])]),_:1},8,["visible"]),i(he,{value:C.value===null?p.value:C.value.id==2?v.value:p.value,paginator:!0,rows:7},qe({header:j(()=>{var a,o,w,Q;return[t("div",Ge,[t("div",He,[t("div",null,[C.value===null||((a=C.value)==null?void 0:a.id)==1?(T(),X(m,{key:0,modelValue:N.value,"onUpdate:modelValue":e[8]||(e[8]=r=>N.value=r),optionLabel:"search",dropdown:"",display:"chip",forceSelection:!0,completeOnFocus:!1,panelStyle:{display:"none"},"dropdown-icon":"pi pi-search",suggestions:x.value,placeholder:" الإسم / النوع / الخطة / الكود",onComplete:e[9]||(e[9]=r=>re(r)),onInput:ue,field:"search"},null,8,["modelValue","suggestions"])):(T(),X(m,{key:1,modelValue:O.value,"onUpdate:modelValue":e[10]||(e[10]=r=>O.value=r),optionLabel:"search",dropdown:"",display:"chip",forceSelection:!0,completeOnFocus:!1,panelStyle:{display:"none"},"dropdown-icon":"pi pi-search",suggestions:_.value,placeholder:" الإسم / النوع / الخطة / الكود",onComplete:e[11]||(e[11]=r=>de(r)),onInput:ie,field:"search"},null,8,["modelValue","suggestions"]))]),t("div",Ke,[t("div",Qe,[i(fe),i(Le,{title:"تقرير الإشتراكات",noText:!0,onSaveReport:e[12]||(e[12]=r=>q(!0)),loading:$.value},null,8,["loading"]),i(ge,{modelValue:C.value,"onUpdate:modelValue":e[13]||(e[13]=r=>C.value=r),onChange:e[14]||(e[14]=r=>c.value=null),options:Y.value,optionLabel:"name",placeholder:"المشتركين ( الفعال )"},null,8,["modelValue","options"]),i(u,{loading:d.value,disabled:((o=c.value)==null?void 0:o.length)!=1,icon:"pi pi-trash",onClick:e[15]||(e[15]=r=>le(r,c.value[0])),label:"الغاء الاشتراك",severity:"danger",outlined:""},null,8,["loading","disabled"]),i(u,{loading:d.value,disabled:((w=c.value)==null?void 0:w.length)!=1,icon:"pi pi-refresh",onClick:e[16]||(e[16]=r=>te(r,c.value[0])),label:"تجديد الاشتراك",severity:"info",outlined:""},null,8,["loading","disabled"]),i(u,{loading:d.value,disabled:((Q=c.value)==null?void 0:Q.length)!=1,icon:"pi pi-plus",onClick:e[17]||(e[17]=r=>Z(c.value[0])),label:"إنشاء الاشتراك",severity:"help",outlined:""},null,8,["loading","disabled"])])])])])]}),list:j(a=>[e[22]||(e[22]=t("div",{style:{"justify-content":"space-between"},class:"tbody flex text-xl w-full mb-6 mt-6"},[t("div",{class:"td"},"تاريخ الإنتهاء"),t("div",{class:"td"},"تاريخ البداية"),t("div",{class:"td"},"كود التفعيل"),t("div",{class:"td"},"إسم الخطة"),t("div",{class:"td"}," نوع المستخدم "),t("div",{class:"th"},"إسم المستخدم")],-1)),(T(!0),H(W,null,je(a.items,o=>(T(),H("div",We,[t("div",Xe,[t("div",Ye,[t("span",Ze,V(o==null?void 0:o.ends_at),1)]),t("div",el,[t("span",ll,V(o==null?void 0:o.starts_at),1)]),t("div",tl,[t("span",sl,V(o.uuid),1)]),t("div",al,[t("span",ol,V(o==null?void 0:o.plan_name),1)]),t("div",nl,[t("span",ul,V(M(o.user_type)),1)]),t("div",rl,[i(ye,{class:"ml-3",name:"option",value:o.uuid,modelValue:c.value,"onUpdate:modelValue":e[18]||(e[18]=w=>c.value=w)},null,8,["value","modelValue"]),t("span",il,V(o.name),1)])])]))),256))]),_:2},[$.value?{name:"empty",fn:j(()=>[t("div",dl,[e[23]||(e[23]=t("br",null,null,-1)),i(Ue,{size:"sm",color:"help",class:"flex justify-center"}),e[24]||(e[24]=t("p",{class:"text bold-18 lh-24 pb-6"}," ...... تحميل المشتركين يرجى الانتظار ",-1)),e[25]||(e[25]=t("br",null,null,-1))])]),key:"0"}:{name:"empty",fn:j(()=>[t("div",cl,[e[26]||(e[26]=t("br",null,null,-1)),i(De,{size:"lm",class:"flex justify-center"}),e[27]||(e[27]=t("h1",{class:"text bold-18 lh-24 pb-6"},"لم يتم العثور على المشتركين ",-1)),e[28]||(e[28]=t("br",null,null,-1))])]),key:"1"}]),1032,["value"])])])])],64)}}},bl=ke(pl,[["__scopeId","data-v-12fe1059"]]);export{bl as default};
