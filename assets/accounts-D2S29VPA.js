import{s as le,a as te}from"./index-urMTnac6.js";import{_ as ae,a as se,r as i,j as oe,k as ne,w as re,o as ue,c as q,h as o,z as de,A as ie,l as x,b as l,m as ce,f as B,n as me,g as I,p as ve,y as pe,F as fe,e as be,t as N,i as ye,q as xe,v as ge,s as _e,x as he}from"./index-DauF410Z.js";import{s as ke}from"./index-Dq0IKLHx.js";import{L as we}from"./loadding-B8WRpMBC.js";import{l as Ve,N as $e}from"./NotFound-9TjzJQwf.js";const Be={class:"grid text-end"},Ne={class:"col-12",style:{"text-align":"end"}},Ce={class:"w-full"},Ie={class:"w-full mt-2 mb-4"},Ue={class:"w-full"},je={class:"w-full"},ze={style:{display:"flex","justify-content":"center","margin-top":"1rem","margin-bottom":"1rem"}},qe={class:"col-12"},Ae={class:"card"},Le={style:{"justify-content":"space-between"},class:"flex mt-2 flex-column md:flex-row md:justify-content-between md:align-items-center"},Se={class:"text-right"},De={class:"flex gap-3"},Te={class:"col-12",style:{"text-align":"end"}},Ee={class:"w-full"},Fe={class:"w-full"},Pe={class:"w-full"},Me={style:{display:"flex","justify-content":"center","margin-top":"1rem","margin-bottom":"1rem"}},Oe={style:{"justify-content":"space-between"},class:"flex mb-4 col-12 flex-column gap-8 p-2 md:justify-content-between md:align-items-center"},Re={class:"td"},Je={class:"td mt-3"},Ge={class:"font-medium text-1xl cursor-pointer"},He={class:"td mt-3"},Ke={class:"font-medium text-1xl cursor-pointer"},Qe={class:"td mt-3"},We={class:"font-medium text-1xl cursor-pointer"},Xe={class:"th mt-3"},Ye={class:"font-medium text-1xl"},Ze={class:"tm mt-3 font-medium text-1xl"},el={class:"loading-state"},ll={class:"empty-state"},tl={__name:"accounts",setup(al){const g=se(),A=i(!1),{proxy:_}=ye(),p=oe(),h=JSON.parse(localStorage.getItem("token")),T=ne(),s=i({nextName:"",prevName:"",prevNumber:"",prevBalance:0,nextNumber:"",nextBalance:null,slug:""}),v=i({name:"",number:"",type:"",slug:""}),k=i(!1),w=i(!1),U=i([]),E=(t,e,d,n)=>{s.value.prevName=e,s.value.prevNumber=parseInt(d),s.value.prevBalance=parseInt(n),s.value.slug=t,w.value=!w.value},F=()=>{k.value=!k.value},c=i(!1),P=async t=>{try{if(c.value=!0,v.value.name==="")p.add({severity:"error",summary:"خطاء في تسجيل الحساب",detail:"الرجاء إضافة إسم الحساب الجديد",life:3e3});else{const e=await B.request({url:_.$localhost+"/api/admin/create-account/"+t,method:"post",headers:{Authorization:"Bearer "+h},data:{account_number:v.value.number,account_holder_name:v.value.name,currency:V.value!==null?V.value.name:"ر.ي"}});e.data.status&&(p.add({severity:"success",summary:"إنشاء الحساب",detail:"تم إنشاء الحساب جديد بنجاح بإسم :  "+v.value.name,life:3e3}),J(e.data.data),k.value=!1,v.value.name="",v.value.number="",V.value=null)}}catch(e){p.add({severity:"error",summary:"إنشاء الحساب",detail:e,life:3e3}),c.value=!1}finally{c.value=!1,A.value=!1}c.value=!1},M=async()=>{c.value=!0;try{const t=await B.request({url:_.$localhost+"/api/admin/update-account/"+s.value.slug,method:"put",headers:{Authorization:"Bearer "+h},data:{account_holder_name:s.value.nextName,account_number:s.value.nextNumber,balance:s.value.nextBalance}});t&&(p.add({severity:"success",summary:"تعديل الحساب",detail:"تم تعديل الحساب بنجاح  ",life:3e3}),H(s.value.slug,t.data.data),w.value=!1,s.value.nextName="",s.value.nextNumber="",s.value.nextBalance=0,s.value.slug="")}catch(t){p.add({severity:"error",summary:"تعديل الحساب",detail:t,life:3e3})}finally{c.value=!1}c.value=!1},y=i(!1),O=async()=>{y.value=!0;try{const t=await B.get(_.$localhost+"/api/admin/banks",{headers:{Authorization:"Bearer "+h}});t.status===200&&(U.value=t.data.data)}catch(t){console.error("Error fetching universities:",t),p.add({severity:"error",summary:"Error",detail:t.message,life:4e3})}y.value=!1},u=i([]),L=async t=>{y.value=!0;try{let e=g.extractDateInput(g.from),d=g.extractDateInput(g.to);const n=await B.get(_.$localhost+"/api/admin/accounts",{headers:{Authorization:"Bearer "+h},params:{from:t?e:null,to:t?d:null}});n.status===200&&(u.value=n.data.data.map(f=>(f.search=`${f.account_number} ${f.account_holder_name} ${f.bank_name}`,f)),m.value=u.value)}catch(e){console.error("Error fetching universities:",e),p.add({severity:"error",summary:"Error",detail:e.message,life:4e3})}y.value=!1,g.displayReport=!1},R=(t,e)=>{T.require({target:t.target,message:"هل انت متأكد من حذف الحساب",icon:"pi pi-exclamation-triangle",rejectProps:{label:"الغاء",severity:"secondary",outlined:!0},acceptProps:{severity:"info",label:"موافق"},accept:()=>{c.value=!0,B.request({url:_.$localhost+"/api/admin/delete-account/"+e,method:"delete",headers:{Authorization:"Bearer "+h}}).then(d=>{d&&(d.data.status?(p.add({severity:"success",summary:"حذف الحساب",detail:"تم حذف الحساب بنجاح  ",life:3e3}),G(e)):p.add({severity:"error",summary:"حذف الحساب",detail:"لا يمكن حذف الحساب لانه مرتبط",life:3e3})),c.value=!1}),c.value=!1},reject:()=>{}})};function J(t){let d=(Array.isArray(t)?t:[t]).map(n=>(n.search=`${n.account_number} ${n.account_holder_name} ${n.bank_name}`,n));u.value=[...d,...u.value],m.value=u.value}function G(t){const e=u.value.findIndex(d=>d.slug===t);e!==-1&&u.value.splice(e,1),m.value=u.value}function H(t,e){const d=u.value.findIndex(n=>n.slug===t);if(d!==-1){const n={...e,search:`${e.account_number} ${e.account_holder_name} ${e.bank_name}`};u.value.splice(d,1,n),m.value=u.value}}const C=i(null),j=i([]);function K(t){setTimeout(()=>{t.query.trim().length?j.value=U.value.filter(e=>e.name.toLowerCase().includes(t.query.toLowerCase())):j.value=[...U.value]},250)}const b=i([]),z=i([]),m=i([]),Q=()=>{b.value=[...m.value],u.value=m.value},W=t=>{setTimeout(()=>{t.query.trim().length!=null||t.query.trim().length!=""?t.inputType==="backspace"||t.query.trim().length===null?(b.value=[...m.value],u.value=m.value):(b.value=m.value.filter(e=>e.search.toLowerCase().includes(t.query.toLowerCase())),u.value=b.value):u.value=m.value},50)};re(z.value,t=>{t.length!==0?(b.value=t.filter(e=>e.search),u.value=b.value):u.value=m.value},{deep:!0});const V=i(null),X=i([{name:"ر.ي"},{name:" ر.س"},{name:"$"}]);return ue(()=>{L(),O()}),(t,e)=>{const d=xe,n=ge,f=te,Y=ke,$=_e,S=me,Z=he,ee=le;return I(),q("div",Be,[o(d),A.value?(I(),de(we,{key:0,"loading-overlay":!0,size:"sm",text:"يرجى الإنتظار",center:!0})):ie("",!0),o(S,{header:"إضافة الحساب",visible:k.value,"onUpdate:visible":e[6]||(e[6]=r=>k.value=r),style:{width:"70vh"},modal:!0},{default:x(()=>[l("div",Ne,[l("div",Ce,[e[14]||(e[14]=l("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"},"إسم الحساب ",-1)),o(n,{style:{"border-color":"var(--p-content-border-color)"},type:"text",placeholder:"الإسم",class:"input_border w-full mb-3 text-end",modelValue:v.value.name,"onUpdate:modelValue":e[0]||(e[0]=r=>v.value.name=r)},null,8,["modelValue"])]),l("div",Ie,[e[15]||(e[15]=l("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," البنوك ",-1)),o(f,{class:"w-full text-end",modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=r=>C.value=r),suggestions:j.value,optionLabel:"name",placeholder:" إختيار البنك",dropdown:"",onComplete:e[2]||(e[2]=r=>K(r))},null,8,["modelValue","suggestions"])]),l("div",Ue,[e[16]||(e[16]=l("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"},"رقم الحساب",-1)),o(n,{style:{"border-color":"var(--p-content-border-color)"},type:"text",placeholder:"رقم الحساب",class:"input_border w-full mb-3 text-end",modelValue:v.value.number,"onUpdate:modelValue":e[3]||(e[3]=r=>v.value.number=r)},null,8,["modelValue"])]),l("div",je,[e[17]||(e[17]=l("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2 text-end"}," العملة ",-1)),o(Y,{modelValue:V.value,"onUpdate:modelValue":e[4]||(e[4]=r=>V.value=r),class:"w-[98%]",options:X.value,optionLabel:"name",placeholder:"بدون عملة"},null,8,["modelValue","options"])]),l("div",ze,[o($,{loading:c.value,disabled:C.value==null,style:{"font-size":"medium"},class:"w-full",severity:"help",onClick:e[5]||(e[5]=r=>{var a;return P((a=C.value)==null?void 0:a.slug)}),label:"إنشاء الحساب"},null,8,["loading","disabled"])])])]),_:1},8,["visible"]),l("div",qe,[l("div",Ae,[e[28]||(e[28]=l("h5",{style:{"font-size":"large"}},"الحسابات",-1)),o(ee,{value:u.value,paginator:!0,rows:7},ce({header:x(()=>[l("div",Le,[l("div",null,[o(f,{modelValue:z.value,"onUpdate:modelValue":e[7]||(e[7]=r=>z.value=r),optionLabel:"search",dropdown:"",display:"chip",forceSelection:!0,completeOnFocus:!1,panelStyle:{display:"none"},"dropdown-icon":"pi pi-search",suggestions:b.value,placeholder:"بحث عن الحساب / الرقم/ البنك",onComplete:e[8]||(e[8]=r=>W(r)),onInput:Q,field:"search"},null,8,["modelValue","suggestions"])]),l("div",Se,[l("div",De,[o(ve,{title:"تقرير الحسابات",onSaveReport:e[9]||(e[9]=r=>L(!0)),loading:y.value},null,8,["loading"]),o($,{onClick:pe(F,["prevent"]),icon:"pi pi-plus",label:"إضافة الحساب",severity:"help",outlined:""})])])])]),list:x(r=>[e[21]||(e[21]=l("div",{class:"tbody col-12 flex flex-column mb-6 mt-4 gap-8",style:{"justify-content":"space-between","font-size":"large"}},[l("div",{class:"td"},"الإعدادات"),l("div",{class:"td"}," التاريخ "),l("div",{class:"td"}," الرصيد "),l("div",{class:"td"}," البنك "),l("div",{class:"th"}," إسم الحساب "),l("div",{class:"tm"}," رقم الحساب ")],-1)),o(d),o(S,{header:"تعديل الحساب",visible:w.value,"onUpdate:visible":e[13]||(e[13]=a=>w.value=a),style:{width:"70vh"},modal:!0},{default:x(()=>[l("div",Te,[l("div",Ee,[e[18]||(e[18]=l("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"},"إسم الحساب ",-1)),o(n,{style:{"border-color":"var(--p-content-border-color)"},type:"text",placeholder:s.value.prevName,class:"input_border w-full mb-3 text-end",modelValue:s.value.nextName,"onUpdate:modelValue":e[10]||(e[10]=a=>s.value.nextName=a)},null,8,["placeholder","modelValue"])]),l("div",Fe,[e[19]||(e[19]=l("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"},"رقم الحساب",-1)),o(n,{style:{"border-color":"var(--p-content-border-color)"},type:"text",placeholder:s.value.prevNumber,class:"input_border w-full mb-3 text-end",modelValue:s.value.nextNumber,"onUpdate:modelValue":e[11]||(e[11]=a=>s.value.nextNumber=a)},null,8,["placeholder","modelValue"])]),l("div",Pe,[e[20]||(e[20]=l("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," الرصيد ",-1)),o(n,{style:{"border-color":"var(--p-content-border-color)"},type:"number",placeholder:s.value.prevBalance,class:"input_border w-full mb-3 text-end",modelValue:s.value.nextBalance,"onUpdate:modelValue":e[12]||(e[12]=a=>s.value.nextBalance=a)},null,8,["placeholder","modelValue"])]),l("div",Me,[o($,{loading:c.value,label:"تعديل الحساب",style:{"font-size":"medium"},class:"w-full btn-icon",unstyled:!0,onClick:M},null,8,["loading"])])])]),_:1},8,["visible"]),(I(!0),q(fe,null,be(r.items,(a,sl)=>(I(),q("div",Oe,[l("div",Re,[o(Z),o($,{loading:c.value,severity:"help",icon:"pi pi-trash",onClick:D=>R(D,a==null?void 0:a.slug)},null,8,["loading","onClick"]),o($,{icon:"pi pi-pencil",severity:"help",class:"mr-4",onClick:D=>E(a==null?void 0:a.slug,a==null?void 0:a.account_holder_name,a.account_number,a.balance)},null,8,["onClick"])]),l("div",Je,[l("span",Ge,N(a.created_at),1)]),l("div",He,[l("span",Ke,N(a.balance),1)]),l("div",Qe,[l("span",We,N(a.bank_name),1)]),l("div",Xe,[l("span",Ye,N(a==null?void 0:a.account_holder_name),1)]),l("span",Ze,N(a.account_number),1)]))),256))]),_:2},[y.value?{name:"empty",fn:x(()=>[l("div",el,[e[22]||(e[22]=l("br",null,null,-1)),o(Ve,{size:"sm",color:"help",class:"flex justify-center"}),e[23]||(e[23]=l("p",{class:"text bold-18 lh-24 pb-6"}," ...... تحميل الحسابات يرجى الانتظار ",-1)),e[24]||(e[24]=l("br",null,null,-1))])]),key:"0"}:{name:"empty",fn:x(()=>[l("div",ll,[e[25]||(e[25]=l("br",null,null,-1)),o($e,{size:"lm",class:"flex justify-center"}),e[26]||(e[26]=l("h1",{class:"text bold-18 lh-24 pb-6"},"لم يتم العثور على الحسابات ",-1)),e[27]||(e[27]=l("br",null,null,-1))])]),key:"1"}]),1032,["value"])])])])}}},il=ae(tl,[["__scopeId","data-v-b398d78b"]]);export{il as default};
