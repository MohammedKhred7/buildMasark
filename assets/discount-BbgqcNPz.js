import{s as te,a as ae}from"./index-Nw62TRQM.js";import{_ as se,r as i,j as oe,k as ne,w as re,o as ie,c as L,h as n,A as ue,B as de,l as _,b as l,m as ce,F as S,f as P,n as me,g as j,e as pe,t as D,i as ve,q as fe,v as xe,s as ye,x as be}from"./index-DjPLoeWi.js";import{s as ge}from"./index-KMRi1HSj.js";import{s as _e}from"./index-BiBlRmX8.js";import{L as he}from"./loadding-CVb4qRT1.js";import{l as we,N as ke}from"./NotFound-DRH08-Sf.js";const Ve={class:"col-12",style:{"text-align":"end"}},$e={class:"width gap-8 mb-2"},Ce={class:"width"},Pe={class:"width"},je={class:"width mb-2"},De={class:"w-full"},Ue={class:"flex justify-between mb-3"},Ae={class:"w-full"},Ne={class:"w-full"},Be={style:{display:"flex","justify-content":"end","margin-top":"1.5rem"}},Le={class:"col-12",style:{"text-align":"end"}},ze={class:"width gap-8 mb-2"},Ie={class:"width"},qe={class:"width"},Te={class:"width mb-2"},Se={class:"w-full"},Ee={class:"flex justify-between mb-3"},Fe={class:"w-full"},Me={class:"w-full"},Oe={style:{display:"flex","justify-content":"end","margin-top":"1.5rem"}},Re={class:"grid text-end"},Je={class:"col-12"},Ge={class:"card"},He={style:{"justify-content":"space-between"},class:"flex mt-2 mb-2 flex-column md:flex-row md:justify-content-between md:align-items-center"},Ke={class:"text-right grid gap-4 font-bold text-1xl"},Qe={class:"grid grid-cols-12 gap-2"},We={class:"col-span-12 sm:col-span-6 lg:col-span-4 p-2"},Xe={class:"p-4 border border-surface-200 dark:border-surface-700 bg-surface-0 dark:bg-surface-900 rounded flex flex-col"},Ye={class:"flex justify-between p-2 text-surface-900 dark:text-surface-0 text-center my-8 text-2xl"},Ze={class:"pt-2 justify-items-center"},el={class:"flex items-center"},ll={class:"font-bold mr-2 ml-2 text-surface-900 dark:text-surface-0 text-4xl"},tl={class:"text-2xl"},al={class:"pt-2 justify-items-center"},sl={class:"flex justify-between p-2 text-surface-900 dark:text-surface-0 text-center my-8 text-1xl"},ol={class:"flex mt-8 pt-2 justify-between"},nl={class:"loading-state"},rl={class:"empty-state"},il={__name:"discount",setup(ul){const E=i(!1);i([]);const{proxy:k}=ve(),f=oe(),V=JSON.parse(localStorage.getItem("token")),F=ne();i(null);const v=i({name:"ر.ي"}),u=i({name:"",description:"",price:"",ads_number:"",number_days:""}),o=i({prevName:"",nextName:"",prevDes:"",nextDes:"",nextPrice:0,prevPeriod:"",nextPeriod:null,prevCurrency:"",prevnumber_days:"",nextnumber_days:null,slug:""}),h=i(!1),M=(t,e,s,d,b,$)=>{o.value.prevName=t,o.value.prevDes=d,o.value.nextPrice=e,o.value.prevPeriod=z(b),o.value.prevCurrency=I(s),o.value.slug=$,h.value=!h.value},x=i(null),w=i(!1),r=i([]),U=i([{name:"ر.ي"},{name:" ر.س"},{name:"$"}]),A=i([{name:"شهر",id:1},{name:"شهرين",id:2},{name:"3 اشهر",id:3},{name:"4 اشهر",id:4},{name:"5 اشهر",id:5},{name:"6 اشهر",id:6},{name:"7 اشهر",id:7},{name:"8 اشهر",id:8},{name:"9 اشهر",id:9},{name:"10 اشهر",id:10},{name:"11 اشهر",id:11},{name:"12 اشهر",id:12}]);function z(t){const e=A.value.find(s=>s.id===t);return e?e.name:null}function I(t){const e=U.value.find(s=>s.name===t);return e?e.name:"ر.ي"}const O=()=>{w.value=!w.value,v.value={name:"ر.ي"}},c=i(!1),R=async()=>{try{c.value=!0;const t=await P.request({url:k.$localhost+"/api/admin/create-plan",method:"post",headers:{Authorization:"Bearer "+V},data:{name:u.value.name,description:u.value.description,price:u.value.price,currency:v.value!==null?v.value.name:0,period:x.value!==null?x.value.id:1}});t.data.status&&(f.add({severity:"success",summary:"إنشاء خطة",detail:"تم إنشاء خطة جديد بنجاح بإسم :  "+u.value.name,life:3e3}),H(t.data.data),w.value=!1,u.value.description="",u.value.name="",u.value.price=0,v.value=null,x.value=null)}catch(t){f.add({severity:"error",summary:"إنشاء خطة",detail:t,life:3e3}),c.value=!1}c.value=!1},J=async()=>{var t,e;try{c.value=!0;const s=await P.request({url:k.$localhost+"/api/admin/update-plan/"+o.value.slug,method:"put",headers:{Authorization:"Bearer "+V},data:{name:o.value.nextName,description:o.value.nextDes,price:o.value.nextPrice,currency:(t=v.value)==null?void 0:t.name,period:(e=x.value)==null?void 0:e.id}});s.data.status&&(f.add({severity:"success",summary:"تعديل خطة",detail:"تم تعديل الخطة جديد بنجاح  :  ",life:3e3}),Q(o.value.slug,s.data.data),h.value=!1,o.value.slug="",o.value.nextName="",o.value.nextDes="",o.value.nextPrice=0,v.value=null,x.value=null)}catch(s){f.add({severity:"error",summary:"تعديل خطة",detail:s,life:3e3}),c.value=!1}c.value=!1},G=(t,e)=>{F.require({target:t.target,message:"هل انت متأكد من حذف خطة",icon:"pi pi-exclamation-triangle",rejectProps:{label:"الغاء",severity:"secondary",outlined:!0},acceptProps:{severity:"help",label:"موافق"},accept:()=>{c.value=!0;try{P.request({url:k.$localhost+"/api/admin/delete-plan/"+e,method:"delete",headers:{Authorization:"Bearer "+V}}).then(s=>{s.status?(f.add({severity:"success",summary:"حذف خطة",detail:"تم حذف خطة بنجاح  ",life:3e3}),K(e)):(console.error("Error deleting plan:",s.status,s.data.message),f.add({severity:"error",summary:"خطأ في حذف الخطة",detail:"لا يمكن حذف الخطة لانه مرتبط بمشتركين ",life:3e3}))}).catch(s=>{console.error("Error deleting plan:",s),f.add({severity:"error",summary:"خطأ في حذف الخطة",detail:"لا يمكن حذف الخطة لانه مرتبط بمشتركين ",life:3500})})}catch(s){console.error("Unexpected error:",s),f.add({severity:"error",summary:"خطأ غير متوقع",detail:"حدث خطأ غير متوقع",life:3e3})}finally{c.value=!1}c.value=!1},reject:()=>{}})};function H(t){let s=(Array.isArray(t)?t:[t]).map(d=>(d.search=`${d.name} ${d.invoice_period} ${d.price}`,d));r.value=[...s,...r.value],p.value=r.value}function K(t){const e=r.value.findIndex(s=>s.slug===t);e!==-1&&r.value.splice(e,1),p.value=r.value}function Q(t,e){const s=r.value.findIndex(d=>d.slug===t);if(s!==-1){const d={...e,search:`${e.name} ${e.invoice_period} ${e.price}`};r.value.splice(s,1,d),p.value=r.value}}const N=i(!1),W=async()=>{N.value=!0;try{const t=await P.get(k.$localhost+"/api/admin/plans",{headers:{Authorization:"Bearer "+V}});t.status===200&&(r.value=t.data.data.map(e=>(e.search=`${e.name} ${e.invoice_period} ${e.price}`,e)),p.value=r.value)}catch(t){console.error("Error fetching universities:",t),f.add({severity:"error",summary:"Error",detail:t.message,life:4e3})}N.value=!1},y=i([]),B=i([]),p=i([]),X=()=>{y.value=[...p.value],r.value=p.value},Y=t=>{setTimeout(()=>{t.query.trim().length!=null||t.query.trim().length!=""?t.inputType==="backspace"||t.query.trim().length===null?(y.value=[...p.value],r.value=p.value):(y.value=p.value.filter(e=>e.search.toLowerCase().includes(t.query.toLowerCase())),r.value=y.value):r.value=p.value},50)};return re(B.value,t=>{t.length!==0?(y.value=t.filter(e=>e.search),r.value=y.value):r.value=p.value},{deep:!0}),ie(()=>{W()}),(t,e)=>{const s=fe,d=he,b=xe,$=_e,C=ge,g=ye,q=me,Z=ae,ee=be,le=te;return j(),L(S,null,[n(s),E.value?(j(),ue(d,{key:0,"loading-overlay":!0,size:"sm",text:"يرجى الإنتظار",center:!0})):de("",!0),n(q,{header:"إضافة خطة",visible:w.value,"onUpdate:visible":e[5]||(e[5]=a=>w.value=a),style:{width:"70vh"},modal:!0},{default:_(()=>[l("div",Ve,[l("div",$e,[l("div",Ce,[e[14]||(e[14]=l("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," إسم الخطة ",-1)),n(b,{style:{"border-color":"var(--p-content-border-color)"},modelValue:u.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.name=a),type:"text",placeholder:"العنوان",class:"input_border w-full mb-3 text-end"},null,8,["modelValue"])]),l("div",Pe,[e[15]||(e[15]=l("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," وصــف الخطة ",-1)),n($,{placeholder:"الوصف",autoResize:!0,rows:"2",modelValue:u.value.description,"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.description=a),class:"w-full text-end"},null,8,["modelValue"])])]),l("div",je,[l("div",De,[e[16]||(e[16]=l("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," سعر الاشتراك ",-1)),n(b,{style:{"border-color":"var(--p-content-border-color)"},type:"text",modelValue:u.value.price,"onUpdate:modelValue":e[2]||(e[2]=a=>u.value.price=a),placeholder:" الرسوم  ",class:"input_border w-[98%] mr-1 mb-3 text-end"},null,8,["modelValue"])]),l("div",Ue,[l("div",Ae,[e[17]||(e[17]=l("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2 text-end"}," العملة ",-1)),n(C,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=a=>v.value=a),class:"w-[98%]",options:U.value,disabled:!0,optionLabel:"name",placeholder:"بدون عملة"},null,8,["modelValue","options"])]),l("div",Ne,[e[18]||(e[18]=l("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," فترة الاشتراك ",-1)),n(C,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=a=>x.value=a),class:"w-[98%]",options:A.value,optionLabel:"name",placeholder:"اختيار الفترة"},null,8,["modelValue","options"])])])]),l("div",Be,[n(g,{loading:c.value,label:"إنشاء خطة",class:"w-full",onClick:R,severity:"help"},null,8,["loading"])])])]),_:1},8,["visible"]),n(q,{header:"إضافة خطة",visible:h.value,"onUpdate:visible":e[11]||(e[11]=a=>h.value=a),style:{width:"70vh"},modal:!0},{default:_(()=>[l("div",Le,[l("div",ze,[l("div",Ie,[e[19]||(e[19]=l("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," إسم الخطة ",-1)),n(b,{style:{"border-color":"var(--p-content-border-color)"},modelValue:o.value.nextName,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.nextName=a),type:"text",placeholder:o.value.prevName,class:"input_border w-full mb-3 text-end"},null,8,["modelValue","placeholder"])]),l("div",qe,[e[20]||(e[20]=l("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," وصــف الخطة ",-1)),n($,{placeholder:o.value.prevDes,autoResize:!0,rows:"2",modelValue:o.value.nextDes,"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.nextDes=a),class:"w-full text-end"},null,8,["placeholder","modelValue"])])]),l("div",Te,[l("div",Se,[e[21]||(e[21]=l("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," سعر الاشتراك ",-1)),n(b,{style:{"border-color":"var(--p-content-border-color)"},type:"number",modelValue:o.value.nextPrice,"onUpdate:modelValue":e[8]||(e[8]=a=>o.value.nextPrice=a),placeholder:"الرسوم",class:"input_border w-[98%] mr-1 mb-3 text-end"},null,8,["modelValue"])]),l("div",Ee,[l("div",Fe,[e[22]||(e[22]=l("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2 text-end"}," العملة ",-1)),n(C,{modelValue:v.value,"onUpdate:modelValue":e[9]||(e[9]=a=>v.value=a),class:"w-[98%]",options:U.value,disabled:!0,optionLabel:"name",placeholder:o.value.prevCurrency},null,8,["modelValue","options","placeholder"])]),l("div",Me,[e[23]||(e[23]=l("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," فترة الاشتراك ",-1)),n(C,{modelValue:x.value,"onUpdate:modelValue":e[10]||(e[10]=a=>x.value=a),class:"w-[98%]",options:A.value,optionLabel:"name",placeholder:o.value.prevPeriod},null,8,["modelValue","options","placeholder"])])])]),l("div",Oe,[n(g,{loading:c.value,label:"تعديل الخطة",class:"w-full",onClick:J,severity:"help"},null,8,["loading"])])])]),_:1},8,["visible"]),l("div",Re,[l("div",Je,[l("div",Ge,[e[30]||(e[30]=l("h5",{style:{"font-size":"large"}},"الخطط",-1)),n(le,{value:r.value,paginator:!0,rows:6},ce({header:_(()=>[l("div",He,[l("div",null,[n(Z,{modelValue:B.value,"onUpdate:modelValue":e[12]||(e[12]=a=>B.value=a),optionLabel:"search",dropdown:"",display:"chip",forceSelection:!0,completeOnFocus:!1,panelStyle:{display:"none"},"dropdown-icon":"pi pi-search",suggestions:y.value,placeholder:"بحث عن الخطة / الفترة / السعر",onComplete:e[13]||(e[13]=a=>Y(a)),onInput:X,field:"search"},null,8,["modelValue","suggestions"])]),l("div",Ke,[n(g,{style:{"font-size":"medium"},label:"إضافة خطة",onClick:O,severity:"help",outlined:""})])])]),list:_(a=>[l("div",Qe,[(j(!0),L(S,null,pe(a.items,m=>(j(),L("div",We,[l("div",Xe,[l("div",Ye,[l("div",null,D(m.name),1),l("div",null,[n(g,{severity:"help",outlined:"",icon:"pi pi-time",label:z(m.invoice_period),class:"p-button border-0 bg-blue-500 text-white"},null,8,["label"])])]),l("div",Ze,[l("div",el,[l("span",ll,D(m.price),1),l("span",tl,D(I(m.currency)),1)])]),l("div",al,[l("span",sl,D(m.description),1)]),l("div",ol,[l("div",null,[n(ee),n(g,{icon:"pi pi-trash",loading:c.value,onClick:T=>G(T,m.slug),severity:"danger",outlined:""},null,8,["loading","onClick"])]),l("div",null,[n(g,{icon:"pi pi-pencil",label:"تعديل",severity:"warn",outlined:"",onClick:T=>M(m.name,m.price,m.currency,m.description,m.invoice_period,m.slug)},null,8,["onClick"])])])])]))),256))])]),_:2},[N.value?{name:"empty",fn:_(()=>[l("div",nl,[e[24]||(e[24]=l("br",null,null,-1)),n(we,{size:"sm",color:"help",class:"flex justify-center"}),e[25]||(e[25]=l("p",{class:"text bold-18 lh-24 pb-6"}," ...... تحميل الخطط يرجى الانتظار ",-1)),e[26]||(e[26]=l("br",null,null,-1))])]),key:"0"}:{name:"empty",fn:_(()=>[l("div",rl,[e[27]||(e[27]=l("br",null,null,-1)),n(ke,{size:"lm",class:"flex justify-center"}),e[28]||(e[28]=l("h1",{class:"text bold-18 lh-24 pb-6"},"لم يتم العثور على الخطط ",-1)),e[29]||(e[29]=l("br",null,null,-1))])]),key:"1"}]),1032,["value"])])])])],64)}}},xl=se(il,[["__scopeId","data-v-fccc9330"]]);export{xl as default};
