import{s as me,a as ve}from"./index-urMTnac6.js";import{_ as ce,a as pe,r as o,j as fe,k as ge,w as E,o as ye,f as h,c as T,h as n,l as C,b as t,m as xe,i as be,n as _e,g as F,p as he,F as we,e as je,t as M,q as Ce,v as ke,s as $e,x as Le}from"./index-DauF410Z.js";import{l as Ve,N as Ue}from"./NotFound-9TjzJQwf.js";import"./index-Dq0IKLHx.js";const Me={class:"grid text-end"},Ae={class:"col-12",style:{"text-align":"end"}},qe={class:"w-full mt-3 mb-3"},ze={class:"w-full mt-2 mb-2"},Ie={class:"w-full mt-2 mb-2"},Ne={style:{display:"flex","justify-content":"center","margin-top":"1rem","margin-bottom":"1rem"}},Be={class:"col-12"},Se={class:"card"},De={style:{"justify-content":"space-between"},class:"flex mt-2 flex-column md:flex-row md:justify-content-between md:align-items-center"},Ee={class:"text-right"},Te={class:"flex gap-3"},Fe={class:"col-12",style:{"text-align":"end"}},Pe={class:"w-full mt-3 mb-3"},Oe={class:"w-full mt-2 mb-2"},Re={class:"w-full mt-2 mb-2"},Je={style:{display:"flex","justify-content":"center","margin-top":"1rem","margin-bottom":"1rem"}},Ge={style:{"justify-content":"space-between"},class:"flex mb-4 col-12 flex-column gap-16 p-2 md:justify-content-between md:align-items-center"},He={class:"td"},Ke={class:"td mt-3"},Qe={class:"font-medium text-1xl cursor-pointer"},We={class:"td mt-3"},Xe={class:"font-medium text-1xl cursor-pointer"},Ye={class:"td mt-3"},Ze={class:"font-medium text-1xl cursor-pointer"},el={class:"td mt-3"},ll={class:"font-medium text-1xl cursor-pointer"},tl={class:"td mt-3"},al={class:"font-medium text-1xl"},sl={class:"loading-state"},ol={class:"empty-state"},nl={__name:"levels",setup(rl){const k=pe(),K=o(!1),{proxy:x}=be(),c=fe(),b=JSON.parse(localStorage.getItem("token")),Q=ge();o("");const u=o({prevName:"",nextName:"",prevMajor:"",nextMajor:"",slug:""}),w=o({name:"",type:"",slug:""}),$=o(!1),L=o(!1),r=o([]),W=(l,e,i)=>{u.value.prevName=e,u.value.slug=l,u.value.prevMajor=i,f.value=null,g.value=null,L.value=!L.value},X=()=>{$.value=!$.value},v=o(!1),Y=async l=>{try{if(v.value=!0,w.value.name==="")c.add({severity:"error",summary:"خطاء في تسجيل المستوى",detail:"الرجاء إضافة إسم المستوى الجديد",life:3e3});else if(l==null||l==null)c.add({severity:"error",summary:"خطاء في تسجيل المستوى",detail:"الرجاءأختيار إسم التخصص  ",life:3e3});else{const e=await h.request({url:x.$localhost+"/api/admin/create-level/"+l,method:"post",headers:{Authorization:"Bearer "+b},data:{level_name:w.value.name}});e.data.status&&(c.add({severity:"success",summary:"إنشاء المستوى",detail:"تم إنشاء المستوى جديد بنجاح بإسم :  "+w.value.name,life:3e3}),le(e.data.data),w.value.name="",$.value=!1,V.value=null)}}catch(e){c.add({severity:"error",summary:"إنشاء المستوى",detail:e,life:3e3}),v.value=!1}finally{v.value=!1,K.value=!1}v.value=!1},Z=async()=>{var l;v.value=!0;try{const e=await h.request({url:x.$localhost+"/api/admin/update-level/"+u.value.slug,method:"post",headers:{Authorization:"Bearer "+b},data:{level_name:u.value.nextName,major_id:(l=u.value.nextMajor)==null?void 0:l.id}});e&&(c.add({severity:"success",summary:"تعديل المستوى",detail:"تم تعديل المستوى بنجاح  ",life:3e3}),ae(u.value.slug,e.data.data),L.value=!1,u.value.slug="",u.value.nextName="",u.value.nextMajor=null)}catch(e){c.add({severity:"error",summary:"تعديل المستوى",detail:e,life:3e3})}finally{v.value=!1}v.value=!1},j=o(!1),P=async l=>{j.value=!0;try{let e=k.extractDateInput(k.from),i=k.extractDateInput(k.to);const d=await h.get(x.$localhost+"/api/admin/levels",{headers:{Authorization:"Bearer "+b},params:{from:l?e:null,to:l?i:null}});d.status===200&&(r.value=d.data.data.map(m=>(m.search=`${m.level_name} ${m.major_name} ${m.college_name} ${m.uni_name}`,m)),p.value=r.value)}catch(e){console.error("Error fetching universities:",e),c.add({severity:"error",summary:"Error",detail:e.message,life:4e3})}j.value=!1,k.displayReport=!1},ee=(l,e)=>{Q.require({target:l.target,message:"هل انت متأكد من حذف المستوى",icon:"pi pi-exclamation-triangle",rejectProps:{label:"الغاء",severity:"secondary",outlined:!0},acceptProps:{severity:"info",label:"موافق"},accept:()=>{v.value=!0,h.request({url:x.$localhost+"/api/admin/delete-level/"+e,method:"get",headers:{Authorization:"Bearer "+b}}).then(i=>{i&&(i.data.status?(c.add({severity:"success",summary:"حذف المستوى",detail:"تم حذف المستوى بنجاح  ",life:3e3}),te(e)):c.add({severity:"error",summary:"حذف المستوى",detail:"لا يمكن حذف المستوى لانه مرتبط باترام ",life:3e3})),v.value=!1}),v.value=!1},reject:()=>{}})};function le(l){let i=(Array.isArray(l)?l:[l]).map(d=>(d.search=`${d.level_name} ${d.major_name} ${d.college_name} ${d.uni_name}`,d));r.value=[...i,...r.value],p.value=r.value}function te(l){const e=r.value.findIndex(i=>i.slug===l);e!==-1&&r.value.splice(e,1),p.value=r.value}function ae(l,e){const i=r.value.findIndex(d=>d.slug===l);if(i!==-1){const d={...e,search:`${e.level_name} ${e.major_name} ${e.college_name} ${e.uni_name}`};r.value.splice(i,1,d),p.value=r.value}}const _=o([]),N=o([]),p=o([]),se=()=>{_.value=[...p.value],r.value=p.value},oe=l=>{setTimeout(()=>{l.query.trim().length!=null||l.query.trim().length!=""?l.inputType==="backspace"||l.query.trim().length===null?(_.value=[...p.value],r.value=p.value):(_.value=p.value.filter(e=>e.search.toLowerCase().includes(l.query.toLowerCase())),r.value=_.value):r.value=p.value},50)};E(N.value,l=>{l.length!==0?(_.value=l.filter(e=>e.search),r.value=_.value):r.value=p.value},{deep:!0});const V=o(null),A=o([]);function O(l){setTimeout(()=>{l.query.trim().length?A.value=B.value.filter(e=>e.major_name.toLowerCase().includes(l.query.toLowerCase())):A.value=[...B.value]},250)}const B=o([]),q=o(!1),ne=async l=>{V.value=null,q.value=!0;try{const e=await h.get(x.$localhost+"/api/admin/majors/"+l,{headers:{Authorization:"Bearer "+b}});e.status===200&&(B.value=e.data.data)}catch(e){console.error("Error fetching Majors:",e),c.add({severity:"error",summary:"Error",detail:e.message,life:4e3})}q.value=!1};ye(()=>{P(),ue()});const g=o(null),z=o([]);function R(l){setTimeout(()=>{l.query.trim().length?z.value=S.value.filter(e=>e.college_name.toLowerCase().includes(l.query.toLowerCase())):z.value=[...S.value]},250)}const S=o([]),y=o(!1),re=async l=>{g.value=null,y.value=!0;try{const e=await h.get(x.$localhost+"/api/admin/colleges/"+l,{headers:{Authorization:"Bearer "+b}});e.status===200&&(S.value=e.data)}catch(e){console.error("Error fetching Colleges:",e),c.add({severity:"error",summary:"Error",detail:e.message,life:4e3})}y.value=!1},D=o([]),ue=async()=>{j.value=!0;try{const l=await h.get(x.$localhost+"/api/admin/universties",{headers:{Authorization:"Bearer "+b}});l.status===200&&(D.value=l.data.data)}catch(l){console.error("Error fetching universities:",l),c.add({severity:"error",summary:"Error",detail:l.message,life:4e3})}j.value=!1},f=o(null),I=o([]);function J(l){setTimeout(()=>{l.query.trim().length?I.value=D.value.filter(e=>e.uni_name.toLowerCase().includes(l.query.toLowerCase())):I.value=[...D.value]},250)}return E(f,(l,e)=>{l!=null&&l.id&&l!==e&&re(l.id)}),E(g,(l,e)=>{l!=null&&l.college_id&&l!==e&&ne(l.college_id)}),(l,e)=>{const i=Ce,d=ke,m=ve,U=$e,G=_e,ie=Le,de=me;return F(),T("div",Me,[n(i),n(G,{header:"إضافة المستوى",visible:$.value,"onUpdate:visible":e[8]||(e[8]=s=>$.value=s),style:{width:"70vh"},modal:!0},{default:C(()=>[t("div",Ae,[e[23]||(e[23]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"},"إسم المستوى ",-1)),n(d,{style:{"border-color":"var(--p-content-border-color)"},type:"text",placeholder:"الإسم",class:"input_border w-full mb-3 text-end",modelValue:w.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>w.value.name=s)},null,8,["modelValue"]),t("div",qe,[e[20]||(e[20]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," إسم الجامعة ",-1)),n(m,{class:"w-full text-end",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=s=>f.value=s),suggestions:I.value,optionLabel:"uni_name",placeholder:"إختيار الجامعة",dropdown:"",onComplete:e[2]||(e[2]=s=>J(s))},null,8,["modelValue","suggestions"])]),t("div",ze,[e[21]||(e[21]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," إسم الكلية ",-1)),n(m,{class:"w-full text-end",modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=s=>g.value=s),loading:y.value,disabled:y.value||!f.value,suggestions:z.value,optionLabel:"college_name",placeholder:" إختيار الكلية",dropdown:"",onComplete:e[4]||(e[4]=s=>R(s))},null,8,["modelValue","loading","disabled","suggestions"])]),t("div",Ie,[e[22]||(e[22]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," إسم التخصص ",-1)),n(m,{class:"w-full text-end",modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=s=>V.value=s),loading:q.value,disabled:q.value||!g.value,suggestions:A.value,optionLabel:"major_name",placeholder:" إختيار التخصص",dropdown:"",onComplete:e[6]||(e[6]=s=>O(s))},null,8,["modelValue","loading","disabled","suggestions"])]),t("div",Ne,[n(U,{loading:v.value,style:{"font-size":"medium"},class:"w-full btn-icon",unstyled:!0,onClick:e[7]||(e[7]=s=>{var a;return Y((a=V.value)==null?void 0:a.slug)}),label:"إنشاء المستوى"},null,8,["loading"])])])]),_:1},8,["visible"]),t("div",Be,[t("div",Se,[e[35]||(e[35]=t("h5",{style:{"font-size":"large"}},"المستويات",-1)),n(de,{value:r.value,paginator:!0,rows:7},xe({header:C(()=>[t("div",De,[t("div",null,[n(m,{modelValue:N.value,"onUpdate:modelValue":e[9]||(e[9]=s=>N.value=s),optionLabel:"search",dropdown:"",display:"chip",forceSelection:!0,completeOnFocus:!1,panelStyle:{display:"none"},"dropdown-icon":"pi pi-search",suggestions:_.value,placeholder:"بحث",onComplete:e[10]||(e[10]=s=>oe(s)),onInput:se,field:"search"},null,8,["modelValue","suggestions"])]),t("div",Ee,[t("div",Te,[n(he,{title:"تقرير المستويات",onSaveReport:e[11]||(e[11]=s=>P(!0)),loading:j.value},null,8,["loading"]),n(U,{onClick:X,style:{"font-size":"medium"},label:"إضافة مستوى",class:"btn-icon",unstyled:!0})])])])]),list:C(s=>[e[28]||(e[28]=t("div",{class:"tbody col-12 flex flex-column mb-6 mt-4 gap-16",style:{"justify-content":"space-between","font-size":"large"}},[t("div",{class:"td"},"الإعدادات"),t("div",{class:"td"}," التاريخ "),t("div",{class:"td"}," الجامعة"),t("div",{class:"td"}," الكلية "),t("div",{class:"td"}," التخصص"),t("div",{class:"td"}," المستوى ")],-1)),n(i),n(G,{header:"تعديل المستوى",visible:L.value,"onUpdate:visible":e[19]||(e[19]=a=>L.value=a),style:{width:"70vh"},modal:!0},{default:C(()=>[t("div",Fe,[e[27]||(e[27]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"},"إسم المستوى ",-1)),n(d,{style:{"border-color":"var(--p-content-border-color)"},type:"text",placeholder:u.value.prevName,class:"input_border w-full mb-3 text-end",modelValue:u.value.nextName,"onUpdate:modelValue":e[12]||(e[12]=a=>u.value.nextName=a)},null,8,["placeholder","modelValue"]),t("div",Pe,[e[24]||(e[24]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," إسم الجامعة ",-1)),n(m,{class:"w-full text-end",modelValue:f.value,"onUpdate:modelValue":e[13]||(e[13]=a=>f.value=a),suggestions:I.value,optionLabel:"uni_name",placeholder:"إختيار الجامعة",dropdown:"",onComplete:e[14]||(e[14]=a=>J(a))},null,8,["modelValue","suggestions"])]),t("div",Oe,[e[25]||(e[25]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," إسم الكلية ",-1)),n(m,{class:"w-full text-end",modelValue:g.value,"onUpdate:modelValue":e[15]||(e[15]=a=>g.value=a),loading:y.value,disabled:y.value||!f.value,suggestions:z.value,optionLabel:"college_name",placeholder:" إختيار الكلية",dropdown:"",onComplete:e[16]||(e[16]=a=>R(a))},null,8,["modelValue","loading","disabled","suggestions"])]),t("div",Re,[e[26]||(e[26]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," إسم التخصص ",-1)),n(m,{class:"w-full text-end",modelValue:u.value.nextMajor,"onUpdate:modelValue":e[17]||(e[17]=a=>u.value.nextMajor=a),loading:y.value,disabled:y.value||!f.value,suggestions:A.value,optionLabel:"major_name",placeholder:u.value.prevMajor,dropdown:"",onComplete:e[18]||(e[18]=a=>O(a))},null,8,["modelValue","loading","disabled","suggestions","placeholder"])]),t("div",Je,[n(U,{loading:v.value,label:"تعديل المستوى",style:{"font-size":"medium"},class:"w-full btn-icon",unstyled:!0,onClick:Z},null,8,["loading"])])])]),_:1},8,["visible"]),(F(!0),T(we,null,je(s.items,a=>(F(),T("div",Ge,[t("div",He,[n(ie),n(U,{loading:v.value,class:"btn-icon",unstyled:!0,icon:"pi pi-trash",onClick:H=>ee(H,a.slug)},null,8,["loading","onClick"]),n(U,{severity:"info",icon:"pi pi-pencil",class:"btn-icon mr-4",unstyled:!0,onClick:H=>W(a.slug,a.level_name,a.major_name)},null,8,["onClick"])]),t("div",Ke,[t("span",Qe,M(a.created_at),1)]),t("div",We,[t("span",Xe,M(a.uni_name),1)]),t("div",Ye,[t("span",Ze,M(a.college_name),1)]),t("div",el,[t("span",ll,M(a.major_name),1)]),t("div",tl,[t("span",al,M(a==null?void 0:a.level_name),1)])]))),256))]),_:2},[j.value?{name:"empty",fn:C(()=>[t("div",sl,[e[29]||(e[29]=t("br",null,null,-1)),n(Ve,{size:"sm",color:"help",class:"flex justify-center"}),e[30]||(e[30]=t("p",{class:"text bold-18 lh-24 pb-6"}," ...... تحميل المستويات يرجى الانتظار ",-1)),e[31]||(e[31]=t("br",null,null,-1))])]),key:"0"}:{name:"empty",fn:C(()=>[t("div",ol,[e[32]||(e[32]=t("br",null,null,-1)),n(Ue,{size:"lm",class:"flex justify-center"}),e[33]||(e[33]=t("h1",{class:"text bold-18 lh-24 pb-6"},"لم يتم العثور على المستويات ",-1)),e[34]||(e[34]=t("br",null,null,-1))])]),key:"1"}]),1032,["value"])])])])}}},vl=ce(nl,[["__scopeId","data-v-130c0b80"]]);export{vl as default};
