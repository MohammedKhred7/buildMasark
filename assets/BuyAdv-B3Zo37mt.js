import{s as be,a as xe}from"./index-urMTnac6.js";import{s as _e}from"./index-DXgW1HSf.js";import{s as we}from"./index-Dq0IKLHx.js";import{_ as ke,a as Ce,r as s,j as Ve,k as $e,w as G,o as Se,f as k,c as H,h as r,b as t,l as j,m as qe,F as W,i as Be,n as Le,g as T,z as X,p as Ae,e as je,t as $,q as Te,s as ze,x as Pe}from"./index-DauF410Z.js";import{l as Ue,N as De}from"./NotFound-9TjzJQwf.js";const Ee={class:"grid text-end"},Fe={class:"col-12"},Ie={class:"card"},Ne={class:"col-12",style:{"text-align":"end"}},Oe={class:"w-full mt-2 mb-6"},Re={class:"w-full mt-2 mb-4"},Je={class:"w-full mb-6"},Me={style:{display:"flex","justify-content":"center"}},Ge={style:{"justify-content":"space-between"},class:"flex mt-2 flex-column md:flex-row md:justify-content-between md:align-items-center"},He={class:"flex justify-between w-full"},Ke={class:"text-right"},Qe={class:"flex gap-3"},We={class:"col-12"},Xe={style:{"justify-content":"space-between"},class:"flex f w-full mb-6"},Ye={class:"td mt-3"},Ze={class:"font-medium text-1xl ml-2"},el={class:"td mt-3"},ll={class:"font-medium text-1xl ml-2"},tl={class:"td mt-3"},sl={class:"text-1xl ml-2"},al={class:"td mt-3"},ol={class:"font-medium text-1xl ml-2"},nl={class:"td mt-3"},ul={class:"font-medium text-1xl ml-2"},rl={class:"th mt-3"},il={class:"text-1xl font-medium"},dl={class:"loading-state"},cl={class:"empty-state"},pl={__name:"BuyAdv",setup(ml){const S=Ce();s(!1);const v=s([]),{proxy:g}=Be(),h=Ve(),b=JSON.parse(localStorage.getItem("token")),K=$e();s(!1),s(!1);const C=s(null),Y=s([{name:"المشتركين ( الفعال )",id:1},{name:"المشتركين ( المنتهي )",id:2}]);s({name:"",email:"",phone:"",password:"",confirm_password:""});const c=s([]),p=s([]),V=s(!1),q=async l=>{V.value=!0;try{let e=S.extractDateInput(S.from),n=S.extractDateInput(S.to);const m=await k.request({url:g.$localhost+"/api/admin/all-subscription",method:"get",headers:{Authorization:"Bearer "+b},params:{from:l?e:null,to:l?n:null}});m.status===200&&(c.value=m.data.data.SubscriptionCurrently.map(u=>(u.search=`${u.name} ${u.uuid}  ${u.plan_name} ${M(u.user_type)}`,u)),f.value=c.value,p.value=m.data.data.EndedSubscription.map(u=>(u.search=`${u.name} ${u.uuid} ${u.plan_name} ${M(u.user_type)}`,u)),y.value=p.value)}catch(e){console.error("Error fetching owners:",e),h.add({severity:"error",summary:"Error",detail:e.message,life:4e3})}finally{V.value=!1,S.displayReport=!1}},B=s(!1),P=s(null),Z=l=>{console.log(l),P.value=l,B.value=!B.value},ee=(l,e)=>{d.value=!0;try{k.request({url:g.$localhost+"/api/admin/create-subscription",method:"post",headers:{Authorization:"Bearer "+b},data:{uuid:P.value,account_id:e,plan_id:l}}).then(n=>{n?(h.add({severity:"success",summary:"إنشاء الاشتراك",detail:"تم إنشاء الاشتراك بنجاح  ",life:3e3}),q(),B.value=!1,P.value="",L.value=null,A.value=null):(h.add({severity:"error",summary:"إنشاء الاشتراك",detail:"حدث خطأ غير متوقع",life:3e3}),console.error("Unexpected response:",n))}).catch(n=>{throw h.add({severity:"error",summary:"إنشاء الاشتراك",detail:n.message,life:3e3}),console.error("Error changing subscription:",n),n}).finally(()=>{d.value=!1})}catch(n){console.error("Outer catch block:",n),d.value=!1}},d=s(!1),le=(l,e)=>{K.require({target:l.target,message:"هل انت متأكد من الغاء الاشتراك",icon:"pi pi-exclamation-triangle",rejectProps:{label:"الغاء",severity:"secondary",outlined:!0},acceptProps:{severity:"help",label:"موافق"},accept:()=>{d.value=!0,k.request({url:g.$localhost+"/api/admin/cancel-subscription/"+e,method:"get",headers:{Authorization:"Bearer "+b}}).then(n=>{n&&(h.add({severity:"success",summary:"الغاء الاشتراك",detail:"تم الغاء الاشتراك بنجاح  ",life:3e3}),q()),d.value=!1}),d.value=!1},reject:()=>{}})},te=(l,e)=>{K.require({target:l.target,message:"هل انت متأكد من تجديد الاشتراك",icon:"pi pi-exclamation-triangle",rejectProps:{label:"الغاء",severity:"secondary",outlined:!0},acceptProps:{severity:"help",label:"موافق"},accept:()=>{d.value=!0,k.request({url:g.$localhost+"/api/admin/renew-subscription/"+e,method:"get",headers:{Authorization:"Bearer "+b}}).then(n=>{n&&(h.add({severity:"success",summary:"تجديد الاشتراك",detail:"تم تجديد الاشتراك بنجاح  ",life:3e3}),q()),d.value=!1}),d.value=!1},reject:()=>{}})};s(null);const U=s([]),se=()=>{k.request({url:g.$localhost+"/api/admin/plans",method:"get",headers:{Authorization:"Bearer "+b}}).then(l=>{l&&(U.value=l.data.data)})},L=s(null),D=s([]);function ae(l){setTimeout(()=>{l.query.trim().length?D.value=U.value.filter(e=>e.name.toLowerCase().includes(l.query.toLowerCase())):D.value=[...U.value]},250)}const E=s(!1),F=s([]),oe=l=>{E.value=!0;try{k.request({url:g.$localhost+"/api/admin/accounts/"+l,method:"post",headers:{Authorization:"Bearer "+b}}).then(e=>{e&&(F.value=e.data.data)})}catch(e){console.log(e)}finally{E.value=!1}},A=s(null),I=s([]);function ne(l){setTimeout(()=>{l.query.trim().length?I.value=F.value.filter(e=>e.account_holder_name.toLowerCase().includes(l.query.toLowerCase())):I.value=[...F.value]},250)}const x=s([]),N=s([]),f=s([]),ue=()=>{x.value=[...f.value],c.value=f.value},re=l=>{setTimeout(()=>{l.query.trim().length!=null||l.query.trim().length!=""?l.inputType==="backspace"||l.query.trim().length===null?(x.value=[...f.value],c.value=f.value):(x.value=f.value.filter(e=>e.search.toLowerCase().includes(l.query.toLowerCase())),c.value=x.value):c.value=f.value},50)},_=s([]),O=s([]),y=s([]),ie=()=>{_.value=[...y.value],p.value=y.value},de=l=>{setTimeout(()=>{l.query.trim().length!=null||l.query.trim().length!=""?l.inputType==="backspace"||l.query.trim().length===null?(_.value=[...y.value],p.value=y.value):(_.value=y.value.filter(e=>e.search.toLowerCase().includes(l.query.toLowerCase())),p.value=_.value):p.value=y.value},50)};G(N.value,l=>{l.length!==0?(x.value=l.filter(e=>e.search),c.value=x.value):c.value=f.value},{deep:!0}),G(O.value,l=>{l.length!==0?(_.value=l.filter(e=>e.search),p.value=_.value):p.value=y.value},{deep:!0}),Se(()=>{q(),se(),pe()});const R=s([]),ce=s([{name:"طالب جامعي",name2:"college_student"},{name:"خريج جامعة",name2:"university_graduate"},{name:"طالب ثانوي",name2:"high_school_graduate"}]),pe=async()=>{V.value=!0;try{const l=await k.get(g.$localhost+"/api/admin/banks",{headers:{Authorization:"Bearer "+b}});l.status===200&&(R.value=l.data.data)}catch(l){console.error("Error fetching universities:",l),h.add({severity:"error",summary:"Error",detail:l.message,life:4e3})}V.value=!1},z=s(null),J=s([]);function me(l){setTimeout(()=>{l.query.trim().length?J.value=R.value.filter(e=>e.name.toLowerCase().includes(l.query.toLowerCase())):J.value=[...R.value]},250)}function M(l){const e=ce.value.find(n=>n.name2===l);return e?e.name:"لم يحدد"}return G(z,(l,e)=>{l!=null&&l.id&&l!==e&&oe(l.id)}),(l,e)=>{const n=Te,m=xe,u=ze,ve=Le,fe=Pe,ye=we,ge=_e,he=be;return T(),H(W,null,[r(n),t("div",Ee,[t("div",Fe,[t("div",Ie,[e[28]||(e[28]=t("h5",{style:{"font-size":"large"}},"الإشتراكات",-1)),r(ve,{header:" الاشتراك",visible:B.value,"onUpdate:visible":e[7]||(e[7]=a=>B.value=a),style:{width:"80vh"},modal:!0},{default:j(()=>[t("div",Ne,[t("div",Oe,[e[18]||(e[18]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," اختيار الخطة ",-1)),r(m,{class:"w-full text-end",modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=a=>L.value=a),suggestions:D.value,optionLabel:"name",placeholder:"الخطة",dropdown:"",onComplete:e[1]||(e[1]=a=>ae(a))},null,8,["modelValue","suggestions"])]),t("div",Re,[e[19]||(e[19]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," البنوك ",-1)),r(m,{class:"w-full text-end",modelValue:z.value,"onUpdate:modelValue":e[2]||(e[2]=a=>z.value=a),suggestions:J.value,optionLabel:"name",placeholder:" إختيار البنك",dropdown:"",onComplete:e[3]||(e[3]=a=>me(a))},null,8,["modelValue","suggestions"])]),t("div",Je,[e[20]||(e[20]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," اختيار الحساب ",-1)),r(m,{class:"w-full text-end",modelValue:A.value,"onUpdate:modelValue":e[4]||(e[4]=a=>A.value=a),disabled:E.value||!z.value,suggestions:I.value,optionLabel:"account_holder_name",placeholder:"الحساب",dropdown:"",onComplete:e[5]||(e[5]=a=>ne(a))},null,8,["modelValue","disabled","suggestions"])]),t("div",Me,[r(u,{loading:d.value,disabled:A.value==null||L.value==null,onClick:e[6]||(e[6]=a=>{var o,w;return ee((o=L.value)==null?void 0:o.id,(w=A.value)==null?void 0:w.account_number)}),label:"إنشاء  الاشتراك ",class:"w-full",severity:"help"},null,8,["loading","disabled"])])])]),_:1},8,["visible"]),r(he,{value:C.value===null?c.value:C.value.id==2?p.value:c.value,paginator:!0,rows:7},qe({header:j(()=>{var a,o,w,Q;return[t("div",Ge,[t("div",He,[t("div",null,[C.value===null||((a=C.value)==null?void 0:a.id)==1?(T(),X(m,{key:0,modelValue:N.value,"onUpdate:modelValue":e[8]||(e[8]=i=>N.value=i),optionLabel:"search",dropdown:"",display:"chip",forceSelection:!0,completeOnFocus:!1,panelStyle:{display:"none"},"dropdown-icon":"pi pi-search",suggestions:x.value,placeholder:" الإسم / النوع / الخطة / الكود",onComplete:e[9]||(e[9]=i=>re(i)),onInput:ue,field:"search"},null,8,["modelValue","suggestions"])):(T(),X(m,{key:1,modelValue:O.value,"onUpdate:modelValue":e[10]||(e[10]=i=>O.value=i),optionLabel:"search",dropdown:"",display:"chip",forceSelection:!0,completeOnFocus:!1,panelStyle:{display:"none"},"dropdown-icon":"pi pi-search",suggestions:_.value,placeholder:" الإسم / النوع / الخطة / الكود",onComplete:e[11]||(e[11]=i=>de(i)),onInput:ie,field:"search"},null,8,["modelValue","suggestions"]))]),t("div",Ke,[t("div",Qe,[r(fe),r(Ae,{title:"تقرير الإشتراكات",noText:!0,onSaveReport:e[12]||(e[12]=i=>q(!0)),loading:V.value},null,8,["loading"]),r(ye,{modelValue:C.value,"onUpdate:modelValue":e[13]||(e[13]=i=>C.value=i),options:Y.value,optionLabel:"name",placeholder:"المشتركين ( الفعال )"},null,8,["modelValue","options"]),r(u,{loading:d.value,disabled:((o=v.value)==null?void 0:o.length)!=1,icon:"pi pi-trash",onClick:e[14]||(e[14]=i=>le(i,v.value[0])),label:"الغاء الاشتراك",severity:"danger",outlined:""},null,8,["loading","disabled"]),r(u,{loading:d.value,disabled:((w=v.value)==null?void 0:w.length)!=1,icon:"pi pi-refresh",onClick:e[15]||(e[15]=i=>te(i,v.value[0])),label:"تجديد الاشتراك",severity:"info",outlined:""},null,8,["loading","disabled"]),r(u,{loading:d.value,disabled:((Q=v.value)==null?void 0:Q.length)!=1,icon:"pi pi-plus",onClick:e[16]||(e[16]=i=>Z(v.value[0])),label:"إنشاء الاشتراك",severity:"help",outlined:""},null,8,["loading","disabled"])])])])])]}),list:j(a=>[e[21]||(e[21]=t("div",{style:{"justify-content":"space-between"},class:"tbody flex text-xl w-full mb-6 mt-6"},[t("div",{class:"td"},"تاريخ الإنتهاء"),t("div",{class:"td"},"تاريخ البداية"),t("div",{class:"td"},"كود التفعيل"),t("div",{class:"td"},"إسم الخطة"),t("div",{class:"td"}," نوع المستخدم "),t("div",{class:"th"},"إسم المستخدم")],-1)),(T(!0),H(W,null,je(a.items,o=>(T(),H("div",We,[t("div",Xe,[t("div",Ye,[t("span",Ze,$(o==null?void 0:o.ends_at),1)]),t("div",el,[t("span",ll,$(o==null?void 0:o.starts_at),1)]),t("div",tl,[t("span",sl,$(o.uuid),1)]),t("div",al,[t("span",ol,$(o==null?void 0:o.plan_name),1)]),t("div",nl,[t("span",ul,$(M(o.user_type)),1)]),t("div",rl,[r(ge,{class:"ml-3",name:"option",value:o.uuid,modelValue:v.value,"onUpdate:modelValue":e[17]||(e[17]=w=>v.value=w)},null,8,["value","modelValue"]),t("span",il,$(o.name),1)])])]))),256))]),_:2},[V.value?{name:"empty",fn:j(()=>[t("div",dl,[e[22]||(e[22]=t("br",null,null,-1)),r(Ue,{size:"sm",color:"help",class:"flex justify-center"}),e[23]||(e[23]=t("p",{class:"text bold-18 lh-24 pb-6"}," ...... تحميل المشتركين يرجى الانتظار ",-1)),e[24]||(e[24]=t("br",null,null,-1))])]),key:"0"}:{name:"empty",fn:j(()=>[t("div",cl,[e[25]||(e[25]=t("br",null,null,-1)),r(De,{size:"lm",class:"flex justify-center"}),e[26]||(e[26]=t("h1",{class:"text bold-18 lh-24 pb-6"},"لم يتم العثور على المشتركين ",-1)),e[27]||(e[27]=t("br",null,null,-1))])]),key:"1"}]),1032,["value"])])])])],64)}}},bl=ke(pl,[["__scopeId","data-v-d4588d52"]]);export{bl as default};
