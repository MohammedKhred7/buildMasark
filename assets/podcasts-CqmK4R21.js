import{s as be,a as he}from"./index-CLwpZUWq.js";import{_ as we,a as ke,z as $e,r as p,j as Ce,k as ze,w as G,o as Ve,c as z,h as d,l as k,b as t,m as Se,i as Ae,f as U,n as je,g as h,A as H,B as T,t as F,F as K,e as Q,p as De,d as Fe,q as Pe,v as Ue,s as Be,I as Ie,x as Te}from"./index-B8p1H9fe.js";import{s as qe}from"./index-oPzeRlZ1.js";import{s as Me,a as Ne}from"./index-CO7-svjp.js";import{s as Le}from"./index-Dvs0exSP.js";import{l as Re,N as Ee}from"./NotFound-CSpOsuBx.js";import"./index-BF1mAKNY.js";const Oe={class:"grid text-end"},Je={class:"col-12",style:{"text-align":"end"}},Ge={class:"w-full"},He={class:"w-full"},Ke={class:"w-full"},Qe={class:"flex flex-wrap justify-between items-center flex-1 gap-4"},We={class:"flex gap-2"},Xe={class:"flex flex-col gap-8 pt-4"},Ye={key:1,class:"text-center text-sm"},Ze={key:2},et={class:"flex flex-wrap gap-4"},tt={class:"relative mx-auto"},at=["alt","src"],lt={class:"font-medium text-ellipsis max-w-40 whitespace-nowrap overflow-hidden"},st={style:{display:"flex","justify-content":"center","margin-top":"1rem","margin-bottom":"1rem"}},ot={class:"col-12"},nt={class:"card"},it={style:{"justify-content":"space-between"},class:"flex mt-2 flex-column md:flex-row md:justify-content-between md:align-items-center"},dt={class:"text-right"},rt={class:"flex gap-3"},ut={class:"grid grid-cols-12 gap-4 mt-2 mb-2"},ct={class:"col-span-12 sm:col-span-4 lg:col-span-4"},pt={class:"p-6 border border-surface-200 dark:border-surface-700 bg-surface-0 dark:bg-surface-900 rounded flex flex-col"},vt={class:"bg-surface-50 flex justify-center rounded p-4"},mt={class:"relative mx-auto"},ft=["src"],yt={class:"dark:bg-surface-900 absolute rounded-border",style:{left:"5px",top:"5px"}},gt={class:"pt-2",style:{direction:"rtl"}},_t={class:"flex flex-col gap-2 mt-4"},xt={class:"text-center text-xl td"},bt={class:"gap-3 mt-2"},ht={class:"text-start td"},wt={class:"text-start mt-1 td"},kt={class:"flex gap-2 mt-1"},$t={style:{"justify-content":"space-between",display:"flex",flex:"auto"}},Ct={class:"flex gap-2"},zt={class:"loading-state"},Vt={class:"empty-state"},St={__name:"podcasts",setup(At){const V=ke(),W=$e(),M=p(!1),{proxy:S}=Ae(),v=Ce(),P=JSON.parse(localStorage.getItem("token")),N=ze(),_=p(!1),B=p(!1),n=p({podcast_name:"",des:"",type:"",slug:""}),x=p(!1),r=p([]),X=p(!1),Y=()=>{n.value={podcast_name:"",des:"",type:"",slug:""},x.value=!x.value},Z=async()=>{var a,e;try{if(_.value=!0,w.value=0,!n.value.podcast_name){v.add({severity:"error",summary:"خطأ",detail:"الرجاء إضافة اسم البودكاست",life:3e3});return}if(!n.value.des){v.add({severity:"error",summary:"خطأ",detail:"الرجاء إضافة وصف البودكاست",life:3e3});return}if(!n.value.type){v.add({severity:"error",summary:"خطأ",detail:"الرجاء اختيار النوع",life:3e3});return}if(!b.value||!(b.value instanceof File)){v.add({severity:"error",summary:"خطأ في الفيديو",detail:"الرجاء اختيار فيديو صالح",life:3e3});return}const s=new FormData;s.append("podcast_name",n.value.podcast_name),s.append("des",n.value.des),s.append("status","active"),s.append("type",n.value.type),s.append("video",b.value),y.value=new AbortController;const l=await U.post(S.$localhost+"/api/admin/create-podcast",s,{headers:{Authorization:`Bearer ${P}`},signal:y.value.signal,onUploadProgress:o=>{o.total&&(w.value=Math.round(o.loaded*100/o.total))}});l.data.status&&(v.add({severity:"success",summary:"تم الإنشاء",detail:"تم إنشاء البودكاست بنجاح",life:3e3}),de(l.data.data),x.value=!1,n.value.podcast_name="",n.value.des="",n.value.type="",b.value=null,w.value=0)}catch(s){s.code==="ERR_CANCELED"?v.add({severity:"warn",summary:"تم الإلغاء",detail:"تم إلغاء رفع الفيديو",life:3e3}):v.add({severity:"error",summary:"خطأ",detail:((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.message)||"فشل رفع الفيديو",life:3e3})}finally{_.value=!1,M.value=!1,y.value=null}},ee=async a=>{var e,s,l,o,c,C;try{_.value=!0;const m=new FormData;m.append("podcast_name",(e=n.value)==null?void 0:e.podcast_name),m.append("des",(s=n.value)==null?void 0:s.des),m.append("status",((l=n.value)==null?void 0:l.status)||"active"),m.append("type",(o=n.value)==null?void 0:o.type),b.value&&m.append("video",b.value);const I=await U.post(`${S.$localhost}/api/admin/update-podcast/${a}`,m,{headers:{Authorization:"Bearer "+P,"Content-Type":"multipart/form-data"}});I.data.status&&(v.add({severity:"success",summary:"تعديل بودكاست",detail:`تم تعديل البودكاست بنجاح بإسم: ${n.value.podcast_name}`,life:3e3}),J(a,I.data.data),x.value=!1,n.value.podcast_name="",n.value.des="")}catch(m){v.add({severity:"error",summary:"خطأ في تعديل البودكاست",detail:((C=(c=m==null?void 0:m.response)==null?void 0:c.data)==null?void 0:C.message)||m.message||"حدث خطأ",life:3e3})}finally{_.value=!1,M.value=!1}},L=async a=>{B.value=!0;try{let e=V.extractDateInput(V.from),s=V.extractDateInput(V.to);const l=await U.get(S.$localhost+"/api/admin/podcasts",{headers:{Authorization:"Bearer "+P},params:{from:a?e:null,to:a?s:null}});l.status===200&&(r.value=l.data.data.map(o=>(o.search=`${o==null?void 0:o.podcast_name} ${o==null?void 0:o.type} ${o==null?void 0:o.des}`,o)),f.value=r.value)}catch(e){console.error("Error fetching universities:",e),v.add({severity:"error",summary:"Error",detail:e.message,life:4e3})}B.value=!1,V.displayReport=!1},te=(a,e)=>{N.require({target:a.target,message:"هل انت متأكد من حذف بودكاست",icon:"pi pi-exclamation-triangle",rejectProps:{label:"الغاء",severity:"secondary",outlined:!0},acceptProps:{severity:"info",label:"موافق"},accept:()=>{_.value=!0,U.request({url:S.$localhost+"/api/admin/delete-podcast/"+e,method:"get",headers:{Authorization:"Bearer "+P}}).then(s=>{s&&(v.add({severity:"success",summary:"حذف بودكاست",detail:"تم حذف بودكاست بنجاح  ",life:3e3}),re(e)),_.value=!1}),_.value=!1},reject:()=>{}})},$=p([]),q=p([]),f=p([]),ae=()=>{$.value=[...f.value],r.value=f.value},le=a=>{setTimeout(()=>{a.query.trim().length!=null||a.query.trim().length!=""?a.inputType==="backspace"||a.query.trim().length===null?($.value=[...f.value],r.value=f.value):($.value=f.value.filter(e=>e.search.toLowerCase().includes(a.query.toLowerCase())),r.value=$.value):r.value=f.value},50)};G(q.value,a=>{a.length!==0?($.value=a.filter(e=>e.search),r.value=$.value):r.value=f.value},{deep:!0});const se=(a,e,s)=>{let l="",o="",c="";s=="active"?(l="هل انت متأكد من اقفال البودكاست",o=" تم اقفال البودكاست بنجاح  ",c="inactive"):(l="هل انت متأكد من فتح البودكاست",o=" تم فتح البودكاست بنجاح  ",c="active"),N.require({target:a.target,message:l,icon:"pi pi-exclamation-triangle",rejectProps:{label:"الغاء",severity:"secondary",outlined:!0},acceptProps:{severity:"info",label:"موافق"},accept:()=>{U.request({url:S.$localhost+"/api/admin/update-podcast/"+e,method:"post",headers:{Authorization:"Bearer "+P},data:{status:c}}).then(C=>{C&&(v.add({severity:"success",summary:"حالة البودكاست",detail:o,life:3e3}),J(e,C.data.data))})},reject:()=>{}})},R=p("");R.value=S.$localhost,Ve(()=>{L()});const E=p(0),w=p(0),b=p([]),oe=(a,e,s)=>{e(s),b.value=null,E.value=0,w.value=0,y.value&&(y.value.abort(),y.value=null)},ne=a=>{var e;b.value=a.files[0],E.value=parseInt(O((e=b.value)==null?void 0:e.size))||0},ie=()=>{v.add({severity:"info",summary:"Success",detail:"File Uploaded",life:3e3})},O=a=>{const l=W.config.locale.fileSizeTypes;if(a===0)return`0 ${l[0]}`;const o=Math.floor(Math.log(a)/Math.log(1024));return`${parseFloat((a/Math.pow(1024,o)).toFixed(3))} ${l[o]}`};function de(a){let s=(Array.isArray(a)?a:[a]).map(l=>(l.search=`${l==null?void 0:l.podcast_name} ${l==null?void 0:l.type} ${l==null?void 0:l.des}`,l));r.value=[...s,...r.value],f.value=r.value}function re(a){const e=r.value.findIndex(s=>s.slug===a);e!==-1&&r.value.splice(e,1),f.value=r.value}function J(a,e){const s=r.value.findIndex(l=>l.slug===a);if(s!==-1){const l={...e,search:`${e==null?void 0:e.podcast_name} ${e==null?void 0:e.type} ${e==null?void 0:e.des}`};r.value.splice(s,1,l),f.value=r.value}}function ue(a){return a==="active"?"فعال":"حظر"}const A=p(!1);function ce(a){n.value={...a},A.value=!0,x.value=!x.value}G(x,a=>{a===!1&&(A.value=!1)});const y=p(null);function pe(a){y.value=new AbortController,a({options:{signal:y.value.signal}})}function ve(){y.value&&(y.value.abort(),y.value=null,uploadPercent.value=0)}return(a,e)=>{const s=Pe,l=Ue,o=Le,c=Be,C=Me,m=Ie,I=Ne,me=je,fe=he,ye=qe,ge=Te,_e=be;return h(),z("div",Oe,[d(s),d(me,{header:A.value?"تعديل البودكاست":"إضافة بودكاست",visible:x.value,"onUpdate:visible":e[5]||(e[5]=i=>x.value=i),style:{width:"70vh"},modal:!0},{default:k(()=>[t("div",Je,[t("div",Ge,[e[9]||(e[9]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"},"إسم بودكاست ",-1)),d(l,{style:{"border-color":"var(--p-content-border-color)"},type:"text",placeholder:"الإسم",class:"input_border w-full mb-3 text-end",modelValue:n.value.podcast_name,"onUpdate:modelValue":e[0]||(e[0]=i=>n.value.podcast_name=i)},null,8,["modelValue"])]),t("div",He,[e[10]||(e[10]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," نوع البودكاست",-1)),d(l,{style:{"border-color":"var(--p-content-border-color)"},placeholder:"النوع",modelValue:n.value.type,"onUpdate:modelValue":e[1]||(e[1]=i=>n.value.type=i),class:"w-full text-end"},null,8,["modelValue"])]),t("div",Ke,[e[11]||(e[11]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"}," وصــف البودكاست",-1)),d(o,{style:{"border-color":"var(--p-content-border-color)"},placeholder:"الوصف",modelValue:n.value.des,"onUpdate:modelValue":e[2]||(e[2]=i=>n.value.des=i),autoResize:!0,rows:"2",class:"w-full text-end"},null,8,["modelValue"])]),A.value?T("",!0):(h(),H(I,{key:0,name:"demo[]",onUpload:e[3]||(e[3]=i=>ie(i)),accept:"video/*",onSelect:ne},{header:k(({chooseCallback:i,uploadCallback:u,clearCallback:j,files:D})=>[t("div",Qe,[t("div",We,[d(c,{onClick:g=>i(),icon:"pi pi-images",rounded:"",outlined:"",severity:"secondary"},null,8,["onClick"]),d(c,{onClick:g=>pe(u),style:{display:"none"},icon:"pi pi-cloud-upload",rounded:"",outlined:"",severity:"success",disabled:!D||D.length===0},null,8,["onClick","disabled"]),d(c,{onClick:ve,icon:"pi pi-times",rounded:"",outlined:"",severity:"danger",disabled:!D||D.length===0},null,8,["disabled"])])])]),content:k(({files:i,uploadedFiles:u,removeUploadedFileCallback:j,removeFileCallback:D})=>[t("div",Xe,[w.value>0?(h(),H(C,{key:0,value:w.value,class:"w-full mt-3"},null,8,["value"])):T("",!0),w.value>0?(h(),z("p",Ye,F(w.value)+"% ",1)):T("",!0),i.length>0?(h(),z("div",Ze,[t("div",et,[(h(!0),z(K,null,Q(i,(g,xe)=>(h(),z("div",{key:g.name+g.type+g.size,class:"p-8 rounded-border flex flex-col border border-surface items-center gap-4"},[t("div",tt,[t("iframe",{role:"presentation",alt:g.name,src:g.objectURL,width:"100",height:"50"},null,8,at)]),t("span",lt,F(g.name),1),t("div",null,F(O(g.size)),1),d(m,{value:"Pending",severity:"warn"}),d(c,{icon:"pi pi-times",onClick:jt=>oe(g,D,xe),outlined:"",rounded:"",severity:"danger"},null,8,["onClick"])]))),128))])])):T("",!0)])]),empty:k(()=>e[12]||(e[12]=[t("div",{class:"flex items-center justify-center flex-col"},[t("i",{class:"pi pi-cloud-upload !border-2 !rounded-full !p-8 !text-4xl !text-muted-color"}),t("p",{class:"mt-6 mb-0"},"اسحب الفديو او اختر الملف")],-1)])),_:1})),t("div",st,[d(c,{loading:_.value,style:{"font-size":"medium"},class:"w-full btn-icon",unstyled:!0,onClick:e[4]||(e[4]=i=>{var u;return A.value?ee((u=n.value)==null?void 0:u.slug):Z()}),label:A.value?"تعديل بودكاست":"إنشاء بودكاست"},null,8,["loading","label"])])])]),_:1},8,["header","visible"]),t("div",ot,[t("div",nt,[e[19]||(e[19]=t("h5",{style:{"font-size":"large"}},"البودكاست",-1)),d(_e,{value:r.value,paginator:!X.value,rows:7},Se({header:k(()=>[t("div",it,[t("div",null,[t("div",null,[d(fe,{modelValue:q.value,"onUpdate:modelValue":e[6]||(e[6]=i=>q.value=i),optionLabel:"search",dropdown:"",display:"chip",forceSelection:!0,completeOnFocus:!1,panelStyle:{display:"none"},"dropdown-icon":"pi pi-search",suggestions:$.value,placeholder:"بحث عن البودكاست أو التخصص ",onComplete:e[7]||(e[7]=i=>le(i)),onInput:ae,field:"search"},null,8,["modelValue","suggestions"])])]),t("div",dt,[t("div",rt,[d(De,{title:"تقرير البودكاست",onSaveReport:e[8]||(e[8]=i=>L(!0)),loading:B.value},null,8,["loading"]),d(c,{onClick:Y,style:{"font-size":"medium"},label:"إضافة بودكاست",severity:"help",outlined:""})])])])]),list:k(i=>[t("div",ut,[(h(!0),z(K,null,Q(i.items,u=>(h(),z("div",ct,[t("div",pt,[t("div",vt,[t("div",mt,[t("iframe",{src:R.value+`/storage/podcasts/${u.video}${u.video.includes("?")?"&":"?"}autoplay=1`,loading:"eager",style:{width:"100%"},allowfullscreen:"",class:"w-full rounded",allow:"encrypted-media"},null,8,ft),t("div",yt,[d(ye,{value:Fe(V).extractDate(u.created_at)},null,8,["value"])])])]),t("div",gt,[t("div",_t,[t("span",xt,F(u.podcast_name),1),t("div",bt,[t("div",ht," الوصف : "+F(u.des),1),t("div",wt," النوع : "+F(u.type),1)]),t("div",kt,[t("div",$t,[t("div",Ct,[d(ge),d(c,{loading:_.value,icon:"pi pi-trash",severity:"danger",onClick:j=>te(j,u.slug),outlined:""},null,8,["loading","onClick"]),d(c,{icon:"pi pi-pencil",severity:"warn",outlined:"",onClick:j=>ce(u)},null,8,["onClick"])]),t("div",null,[d(c,{severity:u.status==="active"?"success":"danger",onClick:j=>se(j,u.slug,u.status),outlined:"",label:ue(u.status)},null,8,["severity","onClick","label"])])])])])])])]))),256))])]),_:2},[B.value?{name:"empty",fn:k(()=>[t("div",zt,[e[13]||(e[13]=t("br",null,null,-1)),d(Re,{size:"sm",color:"help",class:"flex justify-center"}),e[14]||(e[14]=t("p",{class:"text bold-18 lh-24 pb-6"}," ...... تحميل البودكاست يرجى الانتظار ",-1)),e[15]||(e[15]=t("br",null,null,-1))])]),key:"0"}:{name:"empty",fn:k(()=>[t("div",Vt,[e[16]||(e[16]=t("br",null,null,-1)),d(Ee,{size:"lm",class:"flex justify-center"}),e[17]||(e[17]=t("h1",{class:"text bold-18 lh-24 pb-6"},"لم يتم العثور على البودكاست ",-1)),e[18]||(e[18]=t("br",null,null,-1))])]),key:"1"}]),1032,["value","paginator"])])])])}}},qt=we(St,[["__scopeId","data-v-1940ceb3"]]);export{qt as default};
