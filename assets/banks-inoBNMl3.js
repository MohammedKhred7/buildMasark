import{s as K,a as Q}from"./index-DjqfwAtl.js";import{_ as W,a as X,r as i,j as Y,k as Z,w as ee,o as te,c as $,h as n,A as ae,B as le,l as y,b as t,m as se,f as C,n as oe,g as B,p as ne,y as re,F as ie,e as ue,t as V,i as de,q as ce,v as me,s as ve,x as pe}from"./index-D12yBOV5.js";import{L as fe}from"./loadding-BV47m_66.js";import{l as ye,N as ge}from"./NotFound-BtbOrnre.js";import"./index-CdGN-hhu.js";const xe={class:"grid text-end"},be={class:"col-12",style:{"text-align":"end"}},he={style:{display:"flex","justify-content":"center","margin-top":"1rem","margin-bottom":"1rem"}},_e={class:"col-12"},ke={class:"card"},we={style:{"justify-content":"space-between"},class:"flex mt-2 flex-column md:flex-row md:justify-content-between md:align-items-center"},Ce={class:"text-right"},Be={class:"flex gap-3"},Ve={class:"col-12",style:{"text-align":"end"}},Ne={style:{display:"flex","justify-content":"center","margin-top":"1rem","margin-bottom":"1rem"}},$e={style:{"justify-content":"space-between"},class:"flex mb-4 col-12 flex-column gap-8 p-2 md:justify-content-between md:align-items-center"},je={class:"th"},Ie={class:"td mt-3"},Ae={class:"font-medium text-1xl cursor-pointer"},ze={class:"td mt-3"},Ue={class:"font-medium text-1xl cursor-pointer"},qe={class:"th mt-3"},Le={class:"font-medium text-1xl"},De={class:"tm mt-3 font-medium text-1xl"},Te={class:"loading-state"},Se={class:"empty-state"},Ee={__name:"banks",setup(Fe){const g=X(),j=i(!1),{proxy:_}=de(),c=Y(),k=JSON.parse(localStorage.getItem("token")),U=Z();i("");const m=i({prevName:"",nextName:"",prevLevel:"",nextLavel:"",slug:""}),f=i({name:"",type:"",slug:""}),x=i(!1),b=i(!1),l=i([]),q=(a,e)=>{m.value.prevName=e,m.value.slug=a,b.value=!b.value},L=()=>{x.value=!x.value},r=i(!1),D=async()=>{try{if(r.value=!0,f.value.name==="")c.add({severity:"error",summary:"خطاء في تسجيل بنك",detail:"الرجاء إضافة إسم بنك الجديد",life:3e3});else{const a=await C.request({url:_.$localhost+"/api/admin/create-bank",method:"post",headers:{Authorization:"Bearer "+k},data:{name:f.value.name}});a.data.status&&(c.add({severity:"success",summary:"إنشاء بنك",detail:"تم إنشاء بنك جديد بنجاح بإسم :  "+f.value.name,life:3e3}),P(a.data.data),x.value=!1,f.value.name="")}}catch(a){c.add({severity:"error",summary:"إنشاء بنك",detail:a,life:3e3}),r.value=!1}finally{r.value=!1,j.value=!1}r.value=!1},T=async()=>{r.value=!0;try{const a=await C.request({url:_.$localhost+"/api/admin/update-bank/"+m.value.slug,method:"put",headers:{Authorization:"Bearer "+k},data:{name:m.value.nextName}});a&&(c.add({severity:"success",summary:"تعديل بنك",detail:"تم تعديل بنك بنجاح  ",life:3e3}),R(m.value.slug,a.data.data),b.value=!1,m.value.nextName="",m.value.slug="")}catch(a){c.add({severity:"error",summary:"تعديل بنك",detail:a,life:3e3})}finally{r.value=!1}r.value=!1},w=i(!1),I=async a=>{w.value=!0;try{let e=g.extractDateInput(g.from),o=g.extractDateInput(g.to);const v=await C.get(_.$localhost+"/api/admin/banks",{headers:{Authorization:"Bearer "+k},params:{from:a?e:null,to:a?o:null}});v.status===200&&(l.value=v.data.data,u.value=l.value)}catch(e){console.error("Error fetching universities:",e),c.add({severity:"error",summary:"Error",detail:e.message,life:4e3})}w.value=!1,g.displayReport=!1},S=(a,e)=>{U.require({target:a.target,message:"هل انت متأكد من حذف بنك",icon:"pi pi-exclamation-triangle",rejectProps:{label:"الغاء",severity:"secondary",outlined:!0},acceptProps:{severity:"info",label:"موافق"},accept:()=>{r.value=!0;try{C.request({url:_.$localhost+"/api/admin/delete-bank/"+e,method:"delete",headers:{Authorization:"Bearer "+k}}).then(o=>{o.data.status?(c.add({severity:"success",summary:"حذف بنك",detail:"تم حذف بنك بنجاح  ",life:3e3}),M(e)):(console.error("Error deleting plan:",o.status,o.data.message),c.add({severity:"error",summary:"خطأ في حذف البنك",detail:"هذا البنك لا يمكن حذفه لانه مربوط بحسابات",life:3500}))}).catch(o=>{console.error("Error deleting plan:",o),c.add({severity:"error",summary:"خطأ في حذف البنك",detail:"لم يتم حذف البنك",life:3e3})})}catch(o){console.error("Unexpected error:",o),c.add({severity:"error",summary:"خطأ غير متوقع",detail:"حدث خطأ غير متوقع",life:3e3})}finally{r.value=!1}r.value=!1},reject:()=>{}})},p=i([]),N=i([]),u=i([]),E=()=>{p.value=[...u.value],l.value=u.value},F=a=>{setTimeout(()=>{a.query.trim().length!=null||a.query.trim().length!=""?a.inputType==="backspace"||a.query.trim().length===null?(p.value=[...u.value],l.value=u.value):(p.value=u.value.filter(e=>e.name.toLowerCase().includes(a.query.toLowerCase())),l.value=p.value):l.value=u.value},50)};ee(N.value,a=>{a.length!==0?(p.value=a.filter(e=>e.name),l.value=p.value):l.value=u.value},{deep:!0}),te(()=>{I()});function P(a){const e=Array.isArray(a)?a:[a];l.value=[...e,...l.value],u.value=l.value}function M(a){const e=l.value.findIndex(o=>o.slug===a);e!==-1&&l.value.splice(e,1),u.value=l.value}function R(a,e){const o=l.value.findIndex(v=>v.slug===a);if(o!==-1){const v={...e};l.value.splice(o,1,v),u.value=l.value}}return(a,e)=>{const o=ce,v=me,h=ve,A=oe,J=Q,O=pe,G=K;return B(),$("div",xe,[n(o),j.value?(B(),ae(fe,{key:0,"loading-overlay":!0,size:"sm",text:"يرجى الإنتظار",center:!0})):le("",!0),n(A,{header:"إضافة بنك",visible:x.value,"onUpdate:visible":e[2]||(e[2]=d=>x.value=d),style:{width:"70vh"},modal:!0},{default:y(()=>[t("div",be,[e[8]||(e[8]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"},"إسم بنك ",-1)),n(v,{style:{"border-color":"var(--p-content-border-color)"},type:"text",placeholder:"الإسم",class:"input_border w-full mb-3 text-end",modelValue:f.value.name,"onUpdate:modelValue":e[0]||(e[0]=d=>f.value.name=d)},null,8,["modelValue"]),t("div",he,[n(h,{loading:r.value,style:{"font-size":"medium"},class:"w-full btn-icon",unstyled:!0,onClick:e[1]||(e[1]=d=>D()),label:"إنشاء بنك"},null,8,["loading"])])])]),_:1},8,["visible"]),t("div",_e,[t("div",ke,[e[17]||(e[17]=t("h5",{style:{"font-size":"large"}},"البنوك",-1)),n(G,{value:l.value,paginator:!0,rows:7},se({header:y(()=>[t("div",we,[t("div",null,[n(J,{modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=d=>N.value=d),optionLabel:"name",dropdown:"",display:"chip",placeholder:"بحث عن بنك ",multiple:!0,suggestions:p.value,onComplete:e[4]||(e[4]=d=>F(d)),onInput:E,field:"term_name"},null,8,["modelValue","suggestions"])]),t("div",Ce,[t("div",Be,[n(ne,{title:"تقرير البنوك",onSaveReport:e[5]||(e[5]=d=>I(!0)),loading:w.value},null,8,["loading"]),n(h,{onClick:re(L,["prevent"]),icon:"pi pi-plus",label:"إضافة بنك",severity:"help",outlined:""})])])])]),list:y(d=>[e[10]||(e[10]=t("div",{class:"tbody col-12 flex flex-column mb-6 mt-4 gap-8",style:{"justify-content":"space-between","font-size":"large"}},[t("div",{class:"th"},"الإعدادات"),t("div",{class:"td"}," التاريخ "),t("div",{class:"td"}," عدد الحسابات "),t("div",{class:"th"}," إسم البنك "),t("div",{class:"tm"}," الرقم ")],-1)),n(o),n(A,{header:"تعديل بنك",visible:b.value,"onUpdate:visible":e[7]||(e[7]=s=>b.value=s),style:{width:"70vh"},modal:!0},{default:y(()=>[t("div",Ve,[e[9]||(e[9]=t("label",{class:"block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2"},"إسم بنك ",-1)),n(v,{style:{"border-color":"var(--p-content-border-color)"},type:"text",placeholder:m.value.prevName,class:"input_border w-full mb-3 text-end",modelValue:m.value.nextName,"onUpdate:modelValue":e[6]||(e[6]=s=>m.value.nextName=s)},null,8,["placeholder","modelValue"]),t("div",Ne,[n(h,{loading:r.value,label:"تعديل بنك",style:{"font-size":"medium"},class:"w-full btn-icon",unstyled:!0,onClick:T},null,8,["loading"])])])]),_:1},8,["visible"]),(B(!0),$(ie,null,ue(d.items,(s,H)=>(B(),$("div",$e,[t("div",je,[n(O),n(h,{loading:r.value,severity:"help",icon:"pi pi-trash",onClick:z=>S(z,s==null?void 0:s.slug)},null,8,["loading","onClick"]),n(h,{icon:"pi pi-pencil",severity:"help",class:"mr-4",onClick:z=>q(s==null?void 0:s.slug,s==null?void 0:s.name)},null,8,["onClick"])]),t("div",Ie,[t("span",Ae,V(s.created_at),1)]),t("div",ze,[t("span",Ue,V(s.accounts),1)]),t("div",qe,[t("span",Le,V(s==null?void 0:s.name),1)]),t("span",De,V(H+1),1)]))),256))]),_:2},[w.value?{name:"empty",fn:y(()=>[t("div",Te,[e[11]||(e[11]=t("br",null,null,-1)),n(ye,{size:"sm",color:"help",class:"flex justify-center"}),e[12]||(e[12]=t("p",{class:"text bold-18 lh-24 pb-6"}," ...... تحميل البنوك يرجى الانتظار ",-1)),e[13]||(e[13]=t("br",null,null,-1))])]),key:"0"}:{name:"empty",fn:y(()=>[t("div",Se,[e[14]||(e[14]=t("br",null,null,-1)),n(ge,{size:"lm",class:"flex justify-center"}),e[15]||(e[15]=t("h1",{class:"text bold-18 lh-24 pb-6"},"لم يتم العثور على بنوك ",-1)),e[16]||(e[16]=t("br",null,null,-1))])]),key:"1"}]),1032,["value"])])])])}}},Ge=W(Ee,[["__scopeId","data-v-ee4de4e3"]]);export{Ge as default};
